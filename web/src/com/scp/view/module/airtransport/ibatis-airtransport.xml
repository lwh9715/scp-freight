<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap>
	<select id="pages.module.airtransport.jobsBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
	 <![CDATA[
		SELECT row_number() OVER() AS row,* FROM(
		select 
		  *
		  ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.inputer and x.isdelete = false limit 1),t.inputer) AS inputername
		  ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.updater and x.isdelete = false limit 1),t.updater) AS updatername
		  ,(select c.code from sys_corporation c, bus_air b where c.id=b.carrierid AND b.jobid = t.id AND c.isairline  = TRUE) AS carrierid
		  ,(select c.abbr from sys_corporation c, bus_air b where c.id=b.agentid AND b.jobid = t.id AND c.isagent  = TRUE) AS agentid
		  ,(select b.goodsname from sys_corporation c, bus_air b where c.id=b.carrierid AND b.jobid = t.id) AS goodsname
		  ,(CASE WHEN t.statetrace IS NULL THEN NULL ELSE f_sys_getls('userid=$userid$;lskey='||t.statetrace)||'-->'||f_sys_getls('userid=$userid$;lskey=下一步')||':'||COALESCE((SELECT f_sys_getls('userid=$userid$;lskey='||COALESCE(statusc,'')) FROM bus_goodstrack WHERE fkid = t.id AND isfinish = FALSE AND orderno > (SELECT orderno FROM bus_goodstrack WHERE isfinish = TRUE AND fkid = t.id ORDER BY orderno DESC LIMIT 1) ORDER BY orderno, dealdate LIMIT 1),'None') END) statetracenext
		  ,(SELECT putstatus FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS putstatus
		  ,(SELECT flightno1 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS flightno1
		  ,(SELECT flightdate1::DATE FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS flightdate12
		  ,(SELECT arrwmstime::DATE FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS arrwmstime2
		  ,(SELECT namec||'/'||namee||'/'||COALESCE((SELECT name FROM sys_department WHERE id = x.deptid),'') FROM sys_user x WHERE id = t.saleid) saleuser
		  ,(SELECT abbr FROM sys_corporation WHERE id = t.corpidop AND isdelete = FALSE) AS opcompany
		  ,(SELECT abbr FROM sys_corporation WHERE id = t.corpid AND isdelete = FALSE) AS company
		  ,(SELECT substring(b.cnortitle FROM 1 FOR (CASE WHEN position(CHR(10) in b.cnortitle)< 1  THEN length(b.cnortitle) ELSE (position(CHR(10) in b.cnortitle)-1) END)) FROM bus_air b WHERE b.isdelete = FALSE AND b.jobid = t.id) AS cnortitle
		  ,(SELECT substring(b.cneetitle FROM 1 FOR (CASE WHEN position(CHR(10) in b.cneetitle)< 1  THEN length(b.cneetitle) ELSE (position(CHR(10) in b.cneetitle)-1) END)) FROM bus_air b WHERE b.isdelete = FALSE AND b.jobid = t.id) AS cneetitle
		  ,(SELECT (regexp_split_to_array(notifytitle,chr(10)))[1] FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS notifytitle
		  ,(SELECT (regexp_split_to_array(agentdesabbr,chr(10)))[1] FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS agentdesabbr
		   ,(select '件数:'||piece2||' '||'重量:'||weight2||' '||'体积:'||volume2||' '||'计费重:'||chargeweight2 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id ) AS accuratedate
		FROM _fina_jobs_air t
		WHERE $qry$
			$corpfilter$
			$filter$
			$setDays$
			$dynamicClauseWhere$
		AND t.jobtype = 'A'
		AND $icare$
		AND t.isdelete = FALSE
		$ordersql$
		LIMIT $limit$ OFFSET $start$) AS T
	]]>
	</select>
	<select id="pages.module.airtransport.jobsBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 count(*) AS counts 
		FROM _fina_jobs_air t
		WHERE $qry$
			$corpfilter$
			$filter$
			$setDays$
			$dynamicClauseWhere$
		AND $icare$
		AND jobtype = 'A'
	</select>
	
	
	<select id="pages.module.airtransport.jobseditBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
	<![CDATA[
		SELECT DISTINCT	t.id,prefix,code ,r.datefm , t.namec
			FROM sys_busnodesc t ,sys_busnorule r 
			WHERE $qry$
			AND t.id = r.busnotypeid 
			AND code like 'fina_jobs_air%'
			AND t.isdelete = FALSE AND r.isdelete = FALSE
		order by t.namec,r.datefm, prefix
	]]>
	</select>
	<select id="pages.module.airtransport.jobseditBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 10000 AS counts 
	</select>
	
	
	<select id="pages.module.airtransport.busshippingBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 * 
		FROM  _bus_ship_container t 
		WHERE $qry$
		AND isdelete = false
	</select>
	<select id="pages.module.airtransport.busshippingBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 count(*) AS counts 
		FROM  _bus_ship_container t 
		WHERE $qry$ 
	</select>
	
	<select id="pages.module.airtransport.jobslclBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT 
		 * 
		FROM _fina_jobs t 
		WHERE $qry$
			$filter$
			AND jobtype = 'D' 
			AND isdelete = FALSE 
		ORDER BY inputtime DESC
	</select>
	<select id="pages.module.airtransport.jobslclBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT 
		 count(*) AS counts 
		FROM _fina_jobs t 
		WHERE $qry$
			$filter$
			AND jobtype = 'D' 
			AND isdelete = FALSE
	</select>
	
	<select id="pages.module.airtransport.jobslclcheckBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 * 
		FROM _fina_jobs t 
		WHERE $qry$
		AND jobtype = 'D' 
		$filter$
		AND isdelete = FALSE
		AND isubmit = TRUE 
		ORDER BY checktime DESC
	</select>
	<select id="pages.module.airtransport.jobslclcheckBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 count(*) AS counts 
		FROM _fina_jobs t 
		WHERE $qry$
		$filter$
		AND isdelete = FALSE
		AND jobtype = 'D' 
		AND isubmit = TRUE 
	</select>

	<select id="pages.module.airtransport.busshippinglclBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 * 
		FROM  _bus_ship_container t 
		WHERE $qry$
		AND isdelete = false
	</select>
	<select id="pages.module.airtransport.busshippinglclBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 count(*) AS counts 
		FROM  _bus_ship_container t 
		WHERE $qry$ 
	</select>
	
	<select id="pages.module.airtransport.busshippinglclcheckBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 * 
		FROM  _bus_ship_container t 
		WHERE $qry$
		AND isdelete = false
	</select>
	<select id="pages.module.airtransport.busshippinglclcheckBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 count(*) AS counts 
		FROM  _bus_ship_container t 
		WHERE $qry$ 
	</select>
	
	
	<select id="pages.module.airtransport.jobschildBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT DISTINCT t.*, (SELECT mawbno FROM bus_air WHERE jobid = t.id AND isdelete = false) AS mblno,
						(SELECT s.name FROM sys_department s WHERE s.id = t.deptid) AS name FROM(
									<!-- down  -->
									(WITH RECURSIVE  cte  AS  (
																SELECT a.*
																      	,(SELECT SUM(g.chargeweight) FROM bus_goods g,bus_air b WHERE g.linkid = b.id AND b.jobid = a.id AND g.isdelete = FALSE) AS chargeweights
																		,(SELECT SUM(g.grswgt) FROM bus_goods g,bus_air b WHERE g.linkid = b.id AND b.jobid = a.id AND g.isdelete = FALSE) AS weights
																		,(SELECT SUM(g.piece) FROM bus_goods g,bus_air b WHERE g.linkid = b.id AND b.jobid = a.id AND g.isdelete = FALSE) AS pieces 
																       FROM fina_jobs a WHERE $child$
															    UNION ALL 
																SELECT k.*
																		,(SELECT SUM(g.chargeweight) FROM bus_goods g,bus_air b WHERE g.linkid = b.id AND b.jobid = k.id AND g.isdelete = FALSE) AS weights
																		,(SELECT SUM(g.grswgt) FROM bus_goods g,bus_air b WHERE g.linkid = b.id AND b.jobid = k.id AND g.isdelete = FALSE) AS weights
																		,(SELECT SUM(g.piece) FROM bus_goods g,bus_air b WHERE g.linkid = b.id AND b.jobid = k.id AND g.isdelete = FALSE) AS pieces 
																 from fina_jobs k INNER JOIN cte c on c.id = k.parentid
															)SELECT * FROM cte
									)
									
									UNION ALL
									<!-- up  -->
									(WITH RECURSIVE cte  AS (
																SELECT a.*
																		,(SELECT SUM(g.chargeweight) FROM bus_goods g,bus_air b WHERE g.linkid = b.id AND b.jobid = a.id AND g.isdelete = FALSE) AS chargeweights
																		,(SELECT SUM(g.grswgt) FROM bus_goods g,bus_air b WHERE g.linkid = b.id AND b.jobid = a.id AND g.isdelete = FALSE) AS weights
																		,(SELECT SUM(g.piece) FROM bus_goods g,bus_air b WHERE g.linkid = b.id AND b.jobid = a.id AND g.isdelete = FALSE) AS pieces 
																FROM fina_jobs a WHERE $child$
															UNION ALL 
																SELECT k.* 
																		,(SELECT SUM(g.chargeweight) FROM bus_goods g,bus_air b WHERE g.linkid = b.id AND b.jobid = k.id AND g.isdelete = FALSE) AS weights
																		,(SELECT SUM(g.grswgt) FROM bus_goods g,bus_air b WHERE g.linkid = b.id AND b.jobid = k.id AND g.isdelete = FALSE) AS weights
																		,(SELECT SUM(g.piece) FROM bus_goods g,bus_air b WHERE g.linkid = b.id AND b.jobid = k.id AND g.isdelete = FALSE) AS pieces 
																from fina_jobs k INNER JOIN cte c on k.id = c.parentid
															)SELECT * from cte
									)UNION ALL


									<!-- 平级查找-->

									SELECT k.*
											,(SELECT SUM(g.chargeweight) FROM bus_goods g,bus_air b WHERE g.linkid = b.id AND b.jobid = k.id AND g.isdelete = FALSE) AS weights
											,(SELECT SUM(g.grswgt) FROM bus_goods g,bus_air b WHERE g.linkid = b.id AND b.jobid = k.id AND g.isdelete = FALSE) AS weights
											,(SELECT SUM(g.piece) FROM bus_goods g,bus_air b WHERE g.linkid = b.id AND b.jobid = k.id AND g.isdelete = FALSE) AS pieces 
									 FROM fina_jobs k WHERE parentid = $parentid$ AND $child2$ AND isdelete = FALSE
									
						    )AS t
		WHERE $qry$
		$sql3$
		ORDER BY nos
	</select>
	<select id="pages.module.airtransport.jobschildBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
	select 
		 CAST(10 AS BIGINT) AS counts 
		FROM  _fina_jobschild t 
	</select>
	
	
	
	<select id="pages.module.airtransport.airBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 row_number() OVER() AS row,* 
		 ,COALESCE(piece,0) AS piece3
		 ,COALESCE(grswgt,0) AS grswgt2
		 ,COALESCE(cbm,0) AS cbm2
		 ,COALESCE(volumeweight,0) AS volumeweight2
		 ,COALESCE(chargeweight,0) AS chargeweight2
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.inputer and x.isdelete = false limit 1),t.inputer) AS inputername
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.updater and x.isdelete = false limit 1),t.updater) AS updatername
		FROM  bus_goods t 
		WHERE $qry$
		AND isdelete = false
	</select>
	<select id="pages.module.airtransport.airBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 count(*) AS counts 
		FROM  bus_goods t 
		WHERE $qry$ 
		AND isdelete = false
	</select>
	
	
	<select id="pages.module.airtransport.airjobschooseBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 * 
		FROM _fina_jobs t 
		WHERE $qry$
			$corpfilter$
			$filter$
		AND t.jobtype = 'A'
		AND t.isdelete = FALSE
		$ordersql$
	</select>
	<select id="pages.module.airtransport.airjobschooseBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 count(*) AS counts 
		FROM _fina_jobs t 
		WHERE $qry$
			$corpfilter$
			$filter$
		AND t.jobtype = 'A'
		AND t.isdelete = FALSE
		$ordersql$
	</select>
	
	<select id="pages.module.airtransport.airflightBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 * 
		FROM bus_airflight t 
		WHERE $qry$ 
			AND isdelete = FALSE
		ORDER BY carrier ,line,code 
		LIMIT $limit$ OFFSET $start$
	</select>
	<select id="pages.module.airtransport.airflightBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 count(*) AS counts 
		FROM bus_airflight t 
		WHERE $qry$ 
			AND isdelete = FALSE
	</select>
	
	<select id="pages.module.airtransport.busairbillBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 * 
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.inputer and x.isdelete = false limit 1),t.inputer) AS inputername
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.updater and x.isdelete = false limit 1),t.updater) AS updatername
		 ,(SELECT d.code FROM dat_package d WHERE t.packid = d.id AND d.isdelete = FALSE ) AS packdesc
		 ,(CASE bltype WHEN 'H' THEN 'HBL' WHEN 'M' THEN 'MBL' END) AS billtype
		FROM  bus_air_bill t 
		WHERE $qry$
		AND isdelete = FALSE
		ORDER BY hawbno
	</select>
	<select id="pages.module.airtransport.busairbillBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 count(*) AS counts 
		FROM  bus_air_bill t 
		WHERE $qry$ 
		AND isdelete = FALSE
	</select>
	
	<select id="pages.module.airtransport.busairbilleditBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 * 
		 ,COALESCE(piece,0) AS piece3
		 ,COALESCE(grswgt,0) AS grswgt2
		 ,COALESCE(cbm,0) AS cbm2
		 ,COALESCE(volumeweight,0) AS volumeweight2
		 ,COALESCE(chargeweight,0) AS chargeweight2
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.inputer and x.isdelete = false limit 1),t.inputer) AS inputername
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.updater and x.isdelete = false limit 1),t.updater) AS updatername
		FROM  bus_goods t 
		WHERE $qry$
		AND isdelete = false
	</select>
	
	<select id="pages.module.airtransport.busairbilleditBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 count(*) AS counts 
		FROM  bus_goods t 
		WHERE $qry$ 
		AND isdelete = false
	</select>
	
	<select id="pages.module.airtransport.airbillmodelBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 *
		FROM (select 
		 *
		 ,(SELECT abbr FROM sys_corporation WHERE id = x.corpid AND isdelete = FALSE AND iscustomer = FALSE ) corpabbr
		 ,(CASE WHEN filebyte IS NOT NULL THEN TRUE ELSE FALSE END) AS isusermodif
		FROM sys_report x ) t
		WHERE $qry$ 
			$filter$
			AND isdelete = false
			AND modcode='airmodel'
		ORDER BY modcode,code
	</select>
	
	<select id="pages.module.airtransport.airbillmodelBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		  count(*) AS counts 
		FROM (select *
		  ,(SELECT abbr FROM sys_corporation WHERE id = x.corpid AND isdelete = FALSE AND iscustomer = FALSE ) corpabbr
		FROM sys_report x) t
		WHERE $qry$ 
			$filter$
			AND isdelete = false
			AND modcode='airmodel'
	</select>
	
	<select id="pages.module.airtransport.busBillnoMgrBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 * 
		 ,COALESCE((SELECT x.abbr FROM sys_corporation x where x.id = t.carrierid and x.isdelete = false and x.isairline = TRUE limit 1),'') AS carrier
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.inputer and x.isdelete = false limit 1),t.inputer) AS inputername
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.updater and x.isdelete = false limit 1),t.updater) AS updatername
		FROM  bus_billnomgr t 
		WHERE $qry$
			  $qry1$
			  $qryCarr$
		AND isdelete = false
		ORDER BY billno
		LIMIT $limit$ OFFSET $start$
	</select>
	
	<select id="pages.module.airtransport.busBillnoMgrBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 count(*) AS counts 
		FROM  bus_billnomgr t 
		WHERE $qry$
			  $qry1$
			  $qryCarr$
		AND isdelete = false
	</select>
	
	
	<select id="pages.module.airtransport.salecheckBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
	<![CDATA[
		SELECT row_number() OVER() AS row,* FROM(
		select 
		  *
		  ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.inputer and x.isdelete = false limit 1),t.inputer) AS inputername
		  ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.updater and x.isdelete = false limit 1),t.updater) AS updatername
		  ,(select c.code from sys_corporation c, bus_air b where c.id=b.carrierid AND b.jobid = t.id AND c.isairline  = TRUE) AS carrierid
		  ,(select c.abbr from sys_corporation c, bus_air b where c.id=b.agentid AND b.jobid = t.id AND c.isagent  = TRUE) AS agentid
		  ,(select b.goodsname from sys_corporation c, bus_air b where c.id=b.carrierid AND b.jobid = t.id) AS goodsname
		  ,(CASE WHEN t.statetrace IS NULL THEN NULL ELSE f_sys_getls('userid=$userid$;lskey='||t.statetrace)||'-->'||f_sys_getls('userid=$userid$;lskey=下一步')||':'||COALESCE((SELECT f_sys_getls('userid=$userid$;lskey='||COALESCE(statusc,'')) FROM bus_goodstrack WHERE fkid = t.id AND isfinish = FALSE AND orderno > (SELECT orderno FROM bus_goodstrack WHERE isfinish = TRUE AND fkid = t.id ORDER BY orderno DESC LIMIT 1) ORDER BY orderno, dealdate LIMIT 1),'None') END) statetracenext
		  ,(SELECT putstatus FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS putstatus
		  ,(SELECT flightno1 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS flightno1
		  ,(SELECT flightdate1::DATE FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS flightdate12
		  ,(SELECT arrwmstime::DATE FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS arrwmstime2
		  ,(SELECT namec||'/'||namee||'/'||COALESCE((SELECT name FROM sys_department WHERE id = x.deptid),'') FROM sys_user x WHERE id = t.saleid) saleuser
		  ,(SELECT abbr FROM sys_corporation WHERE id = t.corpidop AND isdelete = FALSE) AS opcompany
		  ,(SELECT abbr FROM sys_corporation WHERE id = t.corpid AND isdelete = FALSE) AS company
		  ,(select string_agg(distinct c.goodsname,',') from bus_goods c, bus_air b where c.linkid=b.id AND b.jobid = t.id AND c.isdelete = FALSE AND b.isdelete = FALSE and c.goodsname <> '' and c.goodsname is not null) AS goodsname
		  ,(select taskname from _bpm_task where refid = t.id::text and state <> '3' and state <> '9' ORDER BY taskcreatedtime DESC limit 1) taskname
		  ,(select taskcreatedtime from _bpm_task where refid = t.id::text and state <> '3' and state <> '9' ORDER BY taskcreatedtime DESC limit 1) taskcreatedtime
		  ,(SELECT polcode FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS polcode
		  ,(SELECT podcode FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS podcode
		FROM _fina_jobs_air t
		WHERE $qry$
			$corpfilter$
			$filter$
			$setDays$
			$dynamicClauseWhere$
		AND t.jobtype = 'A'
		AND $icare$
		AND t.isdelete = FALSE
		$ordersql$
		LIMIT $limit$ OFFSET $start$) AS T
		]]>
	</select>
	
	<select id="pages.module.airtransport.salecheckBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 count(*) AS counts 
		FROM _fina_jobs_air t
		WHERE $qry$
			$corpfilter$
			$filter$
			$setDays$
			$dynamicClauseWhere$
		AND $icare$
		AND jobtype = 'A'
	</select>
	
	
	
	<select id="pages.module.airtransport.businesshandleBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
	<![CDATA[
		SELECT row_number() OVER() AS row,* FROM(
		select 
		  *
		  ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.inputer and x.isdelete = false limit 1),t.inputer) AS inputername
		  ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.updater and x.isdelete = false limit 1),t.updater) AS updatername
		  ,(select c.code from sys_corporation c, bus_air b where c.id=b.carrierid AND b.jobid = t.id AND c.isairline  = TRUE) AS carrierid
		  ,(select c.abbr from sys_corporation c, bus_air b where c.id=b.agentid AND b.jobid = t.id AND c.isagent  = TRUE) AS agentid
		  ,(select b.goodsname from sys_corporation c, bus_air b where c.id=b.carrierid AND b.jobid = t.id) AS goodsname
		  ,(CASE WHEN t.statetrace IS NULL THEN NULL ELSE f_sys_getls('userid=$userid$;lskey='||t.statetrace)||'-->'||f_sys_getls('userid=$userid$;lskey=下一步')||':'||COALESCE((SELECT f_sys_getls('userid=$userid$;lskey='||COALESCE(statusc,'')) FROM bus_goodstrack WHERE fkid = t.id AND isfinish = FALSE AND orderno > (SELECT orderno FROM bus_goodstrack WHERE isfinish = TRUE AND fkid = t.id ORDER BY orderno DESC LIMIT 1) ORDER BY orderno, dealdate LIMIT 1),'None') END) statetracenext
		  ,(SELECT putstatus FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS putstatus
		  ,(SELECT flightno1 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS flightno1
		  ,(SELECT flightdate1::DATE FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS flightdate12
		  ,(SELECT arrwmstime::DATE FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS arrwmstime2
		  ,(SELECT namec||'/'||namee||'/'||COALESCE((SELECT name FROM sys_department WHERE id = x.deptid),'') FROM sys_user x WHERE id = t.saleid) saleuser
		  ,(SELECT abbr FROM sys_corporation WHERE id = t.corpidop AND isdelete = FALSE) AS opcompany
		  ,(SELECT abbr FROM sys_corporation WHERE id = t.corpid AND isdelete = FALSE) AS company
		  ,(select string_agg(distinct c.goodsname,',') from bus_goods c, bus_air b where c.linkid=b.id AND b.jobid = t.id AND c.isdelete = FALSE AND b.isdelete = FALSE and c.goodsname <> '' and c.goodsname is not null) AS goodsname
		  ,(select taskname from _bpm_task where refid = t.id::text and state <> '3' and state <> '9' ORDER BY taskcreatedtime DESC limit 1) taskname
		  ,(select taskcreatedtime from _bpm_task where refid = t.id::text and state <> '3' and state <> '9' ORDER BY taskcreatedtime DESC limit 1) taskcreatedtime
		   ,(SELECT piece3 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS piece3
		   ,(SELECT weight3 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS weight3
		   ,(SELECT volume3 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS volume3
		   ,(select '件数:'||piece2||' '||'重量:'||weight2||' '||'体积:'||volume2||' '||'计费重:'||chargeweight2 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id ) AS accuratedate
		   ,(select '件数:'||piece4||' '||'重量:'||weight4||' '||'体积:'||volume4||' '||'计费重:'||chargeweight4 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id ) AS chudandate
		   ,(SELECT sizeremarks FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS sizeremarks
		   ,(SELECT polcode FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS polcode
		   ,(SELECT podcode FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS podcode
		   ,(SELECT bookingcode FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS bookingcode
		   ,(SELECT piece2 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS piece2
		   ,(SELECT weight2 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS weight2
		   ,(SELECT volume2 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS volume2
		   ,(SELECT chargeweight2 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS chargeweight2
		   ,(SELECT string_agg(l::numeric(18,0)||'*'||w::numeric(18,0)||'*'||h::numeric(18,0)||'/'||piece, f_newline() ORDER BY id) FROM bus_goods WHERE isdelete = false AND status = 'airport' AND linkid = ANY(SELECT t.shipid UNION ALL SELECT id FROM bus_air_bill x WHERE x.busairid = t.shipid))AS datasum
		  
		FROM _fina_jobs_air t
		WHERE $qry$
			$corpfilter$
			$filter$
			$setDays$
			$dynamicClauseWhere$
		AND t.jobtype = 'A'
		AND $icare$
		AND t.isdelete = FALSE
		$ordersql$
		LIMIT $limit$ OFFSET $start$) AS T
		]]>
	</select>
	
	<select id="pages.module.airtransport.businesshandleBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 count(*) AS counts 
		FROM _fina_jobs_air t
		WHERE $qry$
			$corpfilter$
			$filter$
			$setDays$
			$dynamicClauseWhere$
		AND $icare$
		AND jobtype = 'A'
	</select>
	
	
	
	<select id="pages.module.airtransport.operatehandleBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
	<![CDATA[
		SELECT row_number() OVER() AS row,* FROM(
		select 
		  *
		  ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.inputer and x.isdelete = false limit 1),t.inputer) AS inputername
		  ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.updater and x.isdelete = false limit 1),t.updater) AS updatername
		  ,(select c.code from sys_corporation c, bus_air b where c.id=b.carrierid AND b.jobid = t.id AND c.isairline  = TRUE) AS carrierid
		  ,(select c.abbr from sys_corporation c, bus_air b where c.id=b.agentid AND b.jobid = t.id AND c.isagent  = TRUE) AS agentid
		  ,(select b.goodsname from sys_corporation c, bus_air b where c.id=b.carrierid AND b.jobid = t.id) AS goodsname
		  ,(CASE WHEN t.statetrace IS NULL THEN NULL ELSE f_sys_getls('userid=$userid$;lskey='||t.statetrace)||'-->'||f_sys_getls('userid=$userid$;lskey=下一步')||':'||COALESCE((SELECT f_sys_getls('userid=$userid$;lskey='||COALESCE(statusc,'')) FROM bus_goodstrack WHERE fkid = t.id AND isfinish = FALSE AND orderno > (SELECT orderno FROM bus_goodstrack WHERE isfinish = TRUE AND fkid = t.id ORDER BY orderno DESC LIMIT 1) ORDER BY orderno, dealdate LIMIT 1),'None') END) statetracenext
		  ,(SELECT putstatus FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS putstatus
		  ,(SELECT flightno1 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS flightno1
		  ,(SELECT flightdate1::DATE FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS flightdate12
		  ,(SELECT arrwmstime::DATE FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS arrwmstime2
		  ,(SELECT namec||'/'||namee||'/'||COALESCE((SELECT name FROM sys_department WHERE id = x.deptid),'') FROM sys_user x WHERE id = t.saleid) saleuser
		  ,(SELECT abbr FROM sys_corporation WHERE id = t.corpidop AND isdelete = FALSE) AS opcompany
		  ,(SELECT abbr FROM sys_corporation WHERE id = t.corpid AND isdelete = FALSE) AS company
		  ,(select string_agg(distinct c.goodsname,',') from bus_goods c, bus_air b where c.linkid=b.id AND b.jobid = t.id AND c.isdelete = FALSE AND b.isdelete = FALSE and c.goodsname <> '' and c.goodsname is not null) AS goodsname
		  ,(select taskname from _bpm_task where refid = t.id::text and state <> '3' and state <> '9' ORDER BY taskcreatedtime DESC limit 1) taskname
		  ,(select taskcreatedtime from _bpm_task where refid = t.id::text and state <> '3' and state <> '9' ORDER BY taskcreatedtime DESC limit 1) taskcreatedtime
		  ,(select c.abbr from sys_corporation c, bus_air b where c.id=b.customscompid AND b.jobid = t.id AND c.iscustom=true) AS customider
		  ,(select  string_agg(hawbno||'('||piece||')' , f_newline()) from  bus_air_bill where isdelete = false and jobid = t.id) AS partnumber
		  ,(SELECT piece3 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS piece3
		  ,(SELECT weight3 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS weight3
		  ,(SELECT volume3 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS volume3
		  ,(SELECT chargeweight3 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS chargeweight3
		  ,(SELECT d.namec FROM bus_air a, dat_filedata d WHERE jobid = t.id and a.freightstation = d.code and d.isdelete = false and d.fkcode = 290 and d.isleaf = TRUE limit 1) AS freightstation
		  ,(SELECT sizeremarks FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS sizeremarks
		  ,(select '件数:'||piece3||' '||'重量:'||weight3||' '||'体积:'||volume3 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id ) AS bookingdate
		  ,(select '件数:'||piece2||' '||'重量:'||weight2||' '||'体积:'||volume2||' '||'计费重:'||chargeweight2 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id ) AS accuratedate
		  ,(select '件数:'||piece4||' '||'重量:'||weight4||' '||'体积:'||volume4||' '||'计费重:'||chargeweight4 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id ) AS chudandate
		  ,(SELECT sizeremarks FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS sizeremarks
		  ,(SELECT polcode FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS polcode
		  ,(SELECT podcode FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS podcode
		  ,(SELECT piece2 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS piece2
		  ,(SELECT weight2 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS weight2
		  ,(SELECT volume2 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS volume2
		  ,(SELECT chargeweight2 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS chargeweight2
		  ,(SELECT string_agg(l::numeric(18,0)||'*'||w::numeric(18,0)||'*'||h::numeric(18,0)||'/'||piece, f_newline() ORDER BY id) FROM bus_goods WHERE isdelete = false AND status = 'airport' AND linkid = ANY(SELECT t.shipid UNION ALL SELECT id FROM bus_air_bill x WHERE x.busairid = t.shipid))AS datasum
		  ,(SELECT  COALESCE((SELECT namec FROM sys_user x WHERE code = f.actorid AND x.isdelete = false limit 1),'') AS assigndesc FROM _bpm_task f,bpm_process c 
			WHERE f.refid::bigint = t.id AND f.taskname='客服跟单' AND c.id=f.processid AND c.namec='审单流程_空运工作单'
			AND EXISTS(SELECT 1 FROM sys_user x, sys_department d WHERE x.code = f.actorid AND x.isdelete = false and x.deptid = d.id and d.name = '深圳空运客服部')) AS assigndesc
		  
		FROM _fina_jobs_air t
		WHERE $qry$
			$corpfilter$
			$filter$
			$setDays$
			$dynamicClauseWhere$
		AND t.jobtype = 'A'
		AND $icare$
		AND t.isdelete = FALSE
		$ordersql$
		LIMIT $limit$ OFFSET $start$) AS T
		]]>
	</select>
	
	<select id="pages.module.airtransport.operatehandleBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 count(*) AS counts 
		FROM _fina_jobs_air t
		WHERE $qry$
			$corpfilter$
			$filter$
			$setDays$
			$dynamicClauseWhere$
		AND $icare$
		AND jobtype = 'A'
	</select>
	
	<select id="pages.module.airtransport.airporthandleBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
	<![CDATA[
		SELECT row_number() OVER() AS row,* FROM(
		select 
		  *
		  ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.inputer and x.isdelete = false limit 1),t.inputer) AS inputername
		  ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.updater and x.isdelete = false limit 1),t.updater) AS updatername
		  ,(select c.code from sys_corporation c, bus_air b where c.id=b.carrierid AND b.jobid = t.id AND c.isairline  = TRUE) AS carrierid
		  ,(select c.abbr from sys_corporation c, bus_air b where c.id=b.agentid AND b.jobid = t.id AND c.isagent  = TRUE) AS agentid
		  ,(select b.goodsname from sys_corporation c, bus_air b where c.id=b.carrierid AND b.jobid = t.id) AS goodsname
		  ,(CASE WHEN t.statetrace IS NULL THEN NULL ELSE f_sys_getls('userid=$userid$;lskey='||t.statetrace)||'-->'||f_sys_getls('userid=$userid$;lskey=下一步')||':'||COALESCE((SELECT f_sys_getls('userid=$userid$;lskey='||COALESCE(statusc,'')) FROM bus_goodstrack WHERE fkid = t.id AND isfinish = FALSE AND orderno > (SELECT orderno FROM bus_goodstrack WHERE isfinish = TRUE AND fkid = t.id ORDER BY orderno DESC LIMIT 1) ORDER BY orderno, dealdate LIMIT 1),'None') END) statetracenext
		  ,(SELECT putstatus FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS putstatus
		  ,(SELECT flightno1 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS flightno1
		  ,(SELECT flightdate1::DATE FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS flightdate12
		  ,(SELECT arrwmstime::DATE FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS arrwmstime2
		  ,(SELECT namec||'/'||namee||'/'||COALESCE((SELECT name FROM sys_department WHERE id = x.deptid),'') FROM sys_user x WHERE id = t.saleid) saleuser
		  ,(SELECT abbr FROM sys_corporation WHERE id = t.corpidop AND isdelete = FALSE) AS opcompany
		  ,(SELECT abbr FROM sys_corporation WHERE id = t.corpid AND isdelete = FALSE) AS company
		  ,(select string_agg(distinct c.goodsname,',') from bus_goods c, bus_air b where c.linkid=b.id AND b.jobid = t.id AND c.isdelete = FALSE AND b.isdelete = FALSE and c.goodsname <> '' and c.goodsname is not null) AS goodsname
		  ,(select taskname from _bpm_task where refid = t.id::text and state <> '3' and state <> '9' ORDER BY taskcreatedtime DESC limit 1) taskname
		  ,(select taskcreatedtime from _bpm_task where refid = t.id::text and state <> '3' and state <> '9' ORDER BY taskcreatedtime DESC limit 1) taskcreatedtime
		  ,(select c.abbr from sys_corporation c, bus_air b where c.id=b.customscompid AND b.jobid = t.id AND c.iscustom=true) AS customider
		   ,(select  string_agg(hawbno||'('||piece||')' , f_newline()) from  bus_air_bill where isdelete = false and jobid = t.id) AS partnumber
		   ,(SELECT piece3 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS piece3
		  ,(SELECT weight3 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS weight3
		  ,(SELECT volume3 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS volume3
		  ,(SELECT chargeweight3 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS chargeweight3
		  ,(SELECT d.namec FROM bus_air a, dat_filedata d WHERE jobid = t.id and a.freightstation = d.code and d.isdelete = false and d.fkcode = 290 and d.isleaf = TRUE limit 1) AS freightstation
		  ,(SELECT d.namec FROM bus_air a, dat_filedata d WHERE jobid = t.id and a.entrytype = d.code and d.isdelete = false and d.fkcode = 280 and d.isleaf = TRUE limit 1) AS entrytype
		  ,(SELECT sizeremarks FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS sizeremarks
		  ,(SELECT cls FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS cls
		  ,(SELECT arrwmstime FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS arrwmstime
		  ,(SELECT airline FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS airline
		  ,(select '件数:'||piece3||' '||'重量:'||weight3||' '||'体积:'||volume3 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id ) AS bookingdate
		  ,(select '件数:'||piece2||' '||'重量:'||weight2||' '||'体积:'||volume2||' '||'计费重:'||chargeweight2 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id ) AS accuratedate
		  ,(SELECT sizeremarks FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS sizeremarks
		  ,(SELECT ordertype2 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS ordertype2
		  ,(SELECT piece2 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS piece2
		  ,(SELECT weight2 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS weight2
		  ,(SELECT volume2 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS volume2
		  ,(SELECT chargeweight2 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS chargeweight2
		  ,(SELECT string_agg(l::numeric(18,0)||'*'||w::numeric(18,0)||'*'||h::numeric(18,0)||'/'||piece, f_newline() ORDER BY id) FROM bus_goods WHERE isdelete = false AND status = 'airport' AND linkid = ANY(SELECT t.shipid UNION ALL SELECT id FROM bus_air_bill x WHERE x.busairid = t.shipid))AS datasum
		  ,(SELECT regexp_replace(c.code,'(\(.*\))','','') FROM sys_corporation c,bus_air b WHERE c.isdelete = FALSE AND b.isdelete = FALSE AND c.id = b.carrierid AND b.jobid = t.id) AS airlinecode
		FROM _fina_jobs_air t
		WHERE $qry$
			$corpfilter$
			$filter$
			$setDays$
			$dynamicClauseWhere$
		AND t.jobtype = 'A'
		AND $icare$
		AND t.isdelete = FALSE
		$ordersql$
		LIMIT $limit$ OFFSET $start$) AS T
		]]>
	</select>
	
	<select id="pages.module.airtransport.airporthandleBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 count(*) AS counts 
		FROM _fina_jobs_air t
		WHERE $qry$
			$corpfilter$
			$filter$
			$setDays$
			$dynamicClauseWhere$
		AND $icare$
		AND jobtype = 'A'
	</select>
	
	
	<select id="pages.module.airtransport.airbillnoseditBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 * 
		FROM  bus_air_bill t 
		WHERE $qry$
		AND isdelete = FALSE
		ORDER BY hawbno
	</select>
	<select id="pages.module.airtransport.airbillnoseditBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 count(*) AS counts 
		FROM  bus_air_bill t 
		WHERE $qry$ 
		AND isdelete = FALSE
	</select>
	
	
	<select id="pages.module.airtransport.airbookingcodeBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 * 
		  ,COALESCE((SELECT x.abbr FROM sys_corporation x where x.id = t.airlineid and x.isdelete = false and x.isairline = TRUE limit 1),'') AS airline
		FROM  air_bookingcode t 
		WHERE $qry$
		AND isdelete = FALSE
		ORDER BY orderno
	</select>
	<select id="pages.module.airtransport.airbookingcodeBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 count(*) AS counts 
		FROM  air_bookingcode t 
		WHERE $qry$ 
		AND isdelete = FALSE
	</select>
	
	<select id="pages.module.airtransport.myjobsBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
	<![CDATA[
		SELECT row_number() OVER() AS row,* FROM(
		select 
		  *
		  ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.inputer and x.isdelete = false limit 1),t.inputer) AS inputername
		  ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.updater and x.isdelete = false limit 1),t.updater) AS updatername
		  ,(select c.code from sys_corporation c, bus_air b where c.id=b.carrierid AND b.jobid = t.id AND c.isairline  = TRUE) AS carrierid
		  ,(select c.abbr from sys_corporation c, bus_air b where c.id=b.agentid AND b.jobid = t.id AND c.isagent  = TRUE) AS agentid
		  ,(select b.goodsname from sys_corporation c, bus_air b where c.id=b.carrierid AND b.jobid = t.id) AS goodsname
		  ,(CASE WHEN t.statetrace IS NULL THEN NULL ELSE f_sys_getls('userid=$userid$;lskey='||t.statetrace)||'-->'||f_sys_getls('userid=$userid$;lskey=下一步')||':'||COALESCE((SELECT f_sys_getls('userid=$userid$;lskey='||COALESCE(statusc,'')) FROM bus_goodstrack WHERE fkid = t.id AND isfinish = FALSE AND orderno > (SELECT orderno FROM bus_goodstrack WHERE isfinish = TRUE AND fkid = t.id ORDER BY orderno DESC LIMIT 1) ORDER BY orderno, dealdate LIMIT 1),'None') END) statetracenext
		  ,(SELECT putstatus FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS putstatus
		  ,(SELECT flightno1 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS flightno1
		  ,(SELECT flightdate1::DATE FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS flightdate12
		  ,(SELECT arrwmstime::DATE FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS arrwmstime2
		  ,(SELECT namec||'/'||namee||'/'||COALESCE((SELECT name FROM sys_department WHERE id = x.deptid),'') FROM sys_user x WHERE id = t.saleid) saleuser
		  ,(SELECT abbr FROM sys_corporation WHERE id = t.corpidop AND isdelete = FALSE) AS opcompany
		  ,(SELECT abbr FROM sys_corporation WHERE id = t.corpid AND isdelete = FALSE) AS company
		  ,(select string_agg(distinct c.goodsname,',') from bus_goods c, bus_air b where c.linkid=b.id AND b.jobid = t.id AND c.isdelete = FALSE AND b.isdelete = FALSE and c.goodsname <> '' and c.goodsname is not null) AS goodsname
		  ,(select taskname from _bpm_task where refid = t.id::text and state <> '3' and state <> '9' ORDER BY taskcreatedtime DESC limit 1) taskname
		  ,(select taskcreatedtime from _bpm_task where refid = t.id::text and state <> '3' and state <> '9' ORDER BY taskcreatedtime DESC limit 1) taskcreatedtime
		   ,(SELECT piece3 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS piece3
		   ,(SELECT weight3 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS weight3
		   ,(SELECT volume3 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS volume3
		   ,(select '件数:'||piece2||' '||'重量:'||weight2||' '||'体积:'||volume2||' '||'计费重:'||chargeweight2 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id ) AS accuratedate
		   ,(select '件数:'||piece4||' '||'重量:'||weight4||' '||'体积:'||volume4||' '||'计费重:'||chargeweight4 FROM bus_air WHERE isdelete = FALSE AND jobid = t.id ) AS chudandate
		   ,(SELECT sizeremarks FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS sizeremarks
		   ,(SELECT polcode FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS polcode
		   ,(SELECT podcode FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS podcode
		   ,(SELECT bookingcode FROM bus_air WHERE isdelete = FALSE AND jobid = t.id) AS bookingcode
		   ,(select taskcreatedtime from _bpm_task where refid = t.id::text and state <> '3' and state <> '9' ORDER BY taskcreatedtime DESC limit 1) taskcreatedtime
		FROM _fina_jobs_air t
		WHERE $qry$
			$corpfilter$
			$filter$
			$setDays$
			$dynamicClauseWhere$
		AND t.jobtype = 'A'
		AND $icare$
		AND t.isdelete = FALSE
		$ordersql$
		LIMIT $limit$ OFFSET $start$) AS T
		]]>
	</select>
	
	<select id="pages.module.airtransport.myjobsBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 count(*) AS counts 
		FROM _fina_jobs_air t
		WHERE $qry$
			$corpfilter$
			$filter$
			$setDays$
			$dynamicClauseWhere$
		AND $icare$
		AND jobtype = 'A'
	</select>
	
	
	<select id="pages.module.airtransport.goodsairportBean.gridUser.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 * 
		FROM _sys_user t 
		WHERE $qry$ 
			AND isdelete = FALSE
			AND isinvalid = TRUE 
			AND EXISTS(SELECT 1 from sys_department d where id = t.deptid and d.isdelete = FALSE and d.corpid = 100 AND d.name = '深圳空运机场办')
			AND (t.jobdesc = '操作' OR t.namec = '陈荣权')
		ORDER BY company,depter2,code
	</select>
	<select id="pages.module.airtransport.goodsairportBean.gridUser.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		 count(*) AS counts 
		FROM _sys_user t 
		WHERE $qry$ 
			AND isdelete = FALSE
			AND isinvalid = TRUE 
			AND EXISTS(SELECT 1 from sys_department d where id = t.deptid and d.isdelete = FALSE and d.corpid = 100 AND d.name = '深圳空运机场办')
			AND (t.jobdesc = '操作' OR t.namec = '陈荣权')
	</select>
	
</sqlMap>
