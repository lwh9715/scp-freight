<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap>
	<select id="pages.module.ship.jobsBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		 <![CDATA[
		 SELECT row_number() OVER() AS row
		 	,*
		 	,(SELECT releasetime FROM bus_customs WHERE jobid = t.id AND isdelete = FALSE order by nos LIMIT 1) AS releasetime
			,(SELECT singtime  FROM bus_customs WHERE jobid = t.id AND isdelete = FALSE order by nos LIMIT 1) AS singtime
			,(SELECT namec from dat_filedata WHERE isleaf = TRUE AND isdelete = false AND fkcode = 40 AND code =(SELECT custype  FROM bus_customs WHERE jobid = t.id AND clstype='O' AND isdelete = FALSE order by nos LIMIT 1)) AS custype
			,(SELECT namec from dat_filedata WHERE isleaf = TRUE AND isdelete = false AND fkcode = 100 AND code =(SELECT status  FROM bus_customs WHERE jobid = t.id AND clstype='O' AND isdelete = FALSE order by nos LIMIT 1)) AS status
			,(SELECT cntcheck_time  FROM bus_customs WHERE jobid = t.id AND isdelete = FALSE order by nos LIMIT 1) AS cntchecktime
			,(SELECT cntrelease_time  FROM bus_customs WHERE jobid = t.id AND isdelete = FALSE order by nos LIMIT 1) AS cntreleasetime
			,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.inputer and x.isdelete = false limit 1),t.inputer) AS inputername
			,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.updater and x.isdelete = false limit 1),t.updater) AS updatername
			,(SELECT count(*) FROM bus_ship_bill WHERE isdelete = FALSE AND bltype = 'H' AND jobid = t.id) AS hblnumber
			,(SELECT count(*) FROM bus_ship_bill WHERE isdelete = FALSE AND bltype = 'M' AND jobid = t.id) AS mblnumber
			,(SELECT bltype FROM bus_shipping WHERE isdelete = FALSE AND jobid = t.id) AS bltype
			,(SELECT putstatus FROM bus_shipping WHERE isdelete = FALSE AND jobid = t.id) AS putstatus
			,(select val from bpm_processinstance x,bpm_processins_var y where x.id = y.processinstanceid AND x.displayname = '新版_放货流程' and x.refno ilike '%'||t.nos||'%' and y.lable = '提单方式' limit 1) as isapplyput
			,(SELECT (CASE WHEN $corpid$ = 100 AND t.corpid = 11540072274 AND b.cnortitle <> '' THEN 'SHENZHEN TOP CHINA IMP & EXP CO.,LTD ADD:RM C1301,SOUTH BUILDING,LUOFANG ROAD,LUOHU,SHENZHEN,CHINA' ELSE b.cnortitle END) FROM bus_shipping b WHERE b.isdelete = FALSE AND b.jobid = t.id) AS cnortitle
			,(SELECT b.cneetitle FROM bus_shipping b WHERE b.isdelete = FALSE AND b.jobid = t.id) AS cneetitle
			,(SELECT notifytitle FROM bus_shipping WHERE isdelete = FALSE AND jobid = t.id) AS notifytitle
			,(select b.nos from _fina_jobs b  where b.id = t.newid) AS foreignnos
			,(SELECT SUM(piece) FROM bus_ship_container WHERE isdelete = FALSE AND jobid = t.id AND parentid is null) AS piece
			,(SELECT packer FROM bus_shipping WHERE isdelete = FALSE AND jobid = t.id) AS packer
			,(SELECT SUM(grswgt) FROM bus_ship_container WHERE isdelete = FALSE AND jobid = t.id AND parentid is null) AS grswgt
			,(SELECT atd FROM bus_shipping WHERE isdelete = FALSE AND jobid = t.id) AS atd
			,(SELECT ata FROM bus_shipping WHERE isdelete = FALSE AND jobid = t.id) AS ata
			,(SELECT SUM(cbm) FROM bus_ship_container WHERE isdelete = FALSE AND jobid = t.id AND parentid is null) AS cbm
			,(SELECT destination FROM bus_shipping WHERE isdelete = FALSE AND jobid = t.id) AS destination
			,(SELECT y.namec FROM bus_shipping x,dat_goodstype y WHERE x.isdelete = FALSE AND x.jobid = t.id AND x.goodstypeid = y.id) AS goodstypenamec
			,COALESCE((SELECT y.abbr FROM bus_shipping x,sys_corporation y WHERE x.isdelete = FALSE AND x.jobid = t.id AND x.agentdesid = y.id),'') AS agentdesidabbr
			,(SELECT (CASE WHEN x.truckstate = 'I' THEN '初始' ELSE '完成' END) FROM bus_truck x,dat_filedata y WHERE x.isdelete = FALSE AND x.jobid = t.id AND x.truckstate = y.code LIMIT 1) AS truckstate
			,(SELECT isinsurance FROM bus_truck WHERE isdelete = FALSE AND jobid = t.id LIMIT 1) AS isinsurance
			,(SELECT y.abbr FROM bus_truck x,sys_corporation y WHERE x.isdelete = FALSE AND x.jobid = t.id AND x.truckid = y.id LIMIT 1) AS truckabbr
			,(SELECT y.abbr FROM bus_customs x,sys_corporation y WHERE x.isdelete = FALSE AND x.jobid = t.id AND x.customid = y.id LIMIT 1) AS customsabbr
			,(SELECT y.namec FROM bus_truck x,dat_filedata y WHERE x.isdelete = FALSE AND x.jobid = t.id AND x.trucktype = y.code AND x.trucktype IS NOT NULL AND x.trucktype <> '' AND y.isleaf = TRUE AND y.isdelete = false AND y.fkcode = 110 LIMIT 1) AS trucktype
			,(SELECT iscls FROM bus_truck WHERE isdelete = FALSE AND jobid = t.id LIMIT 1) AS iscls
			,(SELECT string_agg(x.namec,',') FROM sys_user x , sys_user_assign y WHERE x.id =y.userid AND y.roletype = 'F' AND y.linkid = t.shipid AND  COALESCE(y.isdelete,false) = false)  AS finance
			,(SELECT clstime FROM bus_shipping WHERE isdelete = FALSE AND jobid = t.id) AS clstime
			,(select c.abbr from sys_corporation c, bus_shipping b where c.id=b.agentid AND b.jobid = t.id AND c.isagent  = TRUE AND b.isdelete = FALSE) AS agenter
			,(SELECT namec FROM dat_filedata WHERE isdelete = false AND fkcode = 150 AND isleaf = TRUE AND code = t.mbltype LIMIT 1) AS mbltypedesc
			,CASE WHEN ldtype = 'F' THEN (SELECT count(*) FROM bus_ship_container WHERE isdelete = false and parentid is null AND jobid = t.id) ELSE 0 END AS cncount
			,(CASE WHEN t.statetrace IS NULL THEN NULL ELSE f_common_array_position((SELECT array_agg(statusc ORDER BY orderno  ,dealdate , id) FROM bus_goodstrack WHERE fkid = t.id $isShowIscs$),t.statetrace)
			||'/'||(select count(1) FROM bus_goodstrack WHERE fkid = t.id AND isdelete = false  $isShowIscs$)
			||':'||f_sys_getls('userid=$userid$;lskey='||t.statetrace) END) statetracenext
			,(SELECT namec from dat_filedata WHERE isleaf = TRUE AND isdelete = false AND fkcode = 120 AND code =(SELECT clearingstate  FROM bus_customs WHERE jobid = t.id AND clstype='I' AND isdelete = FALSE order by nos LIMIT 1)) AS clearstate
			,(SELECT namec FROM sys_user x,bus_shipping y WHERE x.isdelete = FALSE AND y.isdelete = FALSE AND x.id = y.priceuserid AND y.jobid = t.id) priceusernamec
			,(SELECT contractno FROM bus_shipping WHERE isdelete = FALSE AND jobid = t.id) AS contractno
			,(now()::DATE - t.eta) AS now_eta
			,(SELECT namec||'/'||namee||'/'||COALESCE((SELECT name FROM sys_department WHERE id = x.deptid),'') FROM sys_user x WHERE id = t.saleid) saleuser
			,(select c.namec from dat_line c, bus_shipping b where (c.code = b.routecode OR c.namec = b.routecode or c.namec ilike ('%'|| b.routecode ||'%')) AND b.jobid = t.id AND c.isdelete = false
				and lintype='S' LIMIT 1) AS routecode
			,(SELECT abbr FROM sys_corporation WHERE id = t.corpidop AND isdelete = FALSE) AS opcompany
			,(SELECT abbr FROM sys_corporation WHERE id = t.corpid AND isdelete = FALSE) AS company
			,(SELECT namec FROM sys_corporation WHERE id = t.customerid AND isdelete = FALSE) AS customernamec
			,(SELECT poa FROM bus_shipping WHERE isdelete = FALSE AND jobid = t.id) AS poa
			,(SELECT namec from dat_filedata WHERE isleaf = TRUE AND isdelete = false AND fkcode = 140 AND code =(SELECT hbltype FROM bus_shipping WHERE jobid = t.id and isdelete = false)) AS hbltypedesc
			,(SELECT (regexp_split_to_array(agentitle,chr(10)))[1] FROM bus_shipping WHERE isdelete = FALSE AND jobid = t.id) AS agentitle
			,(SELECT f_fina_jobs_cnts('jobid='::text||t.id)) AS cnts
			,(SELECT f_fina_jobs_cntdesc('jobid='::text||t.id)) AS cntdescnew
			,(SELECT namec FROM dat_filedata x , bus_shipping y WHERE x.isdelete = false AND x.fkcode = 320 AND x.isleaf = TRUE AND x.code = y.busstatus AND y.jobid = t.id LIMIT 1) AS busstatusdesc
			,(SELECT isreleasecnt FROM bus_shipping WHERE jobid = t.id AND isdelete = FALSE) AS isreleasecnt
			,(SELECT releasecnttime FROM bus_shipping WHERE jobid = t.id AND isdelete = FALSE) AS releasecnttime
			,(SELECT ispickcnt FROM bus_shipping WHERE jobid = t.id AND isdelete = FALSE) AS ispickcnt
			,(SELECT pickcnttime FROM bus_shipping WHERE jobid = t.id AND isdelete = FALSE) AS pickcnttime
			,(SELECT isreturncnt FROM bus_shipping WHERE jobid = t.id AND isdelete = FALSE) AS isreturncnt
			,(SELECT returncnttime FROM bus_shipping WHERE jobid = t.id AND isdelete = FALSE) AS returncnttime
			,(SELECT shipagent FROM bus_shipping WHERE jobid = t.id ) AS shipagent
			,(SELECT potcode FROM bus_shipping WHERE isdelete = FALSE AND jobid = t.id) AS potcode
			,(SELECT sodate FROM bus_shipping WHERE isdelete = FALSE AND jobid = t.id) AS sodate
			,(SELECT string_agg(COALESCE(namec,'')||'/'||COALESCE(namee,''),',') FROM sys_user x , sys_user_assign y WHERE x.id =y.userid AND y.roletype = 'K' AND y.linkid = t.shipid AND  COALESCE(y.isdelete,false) = false)  AS bookinger
			,(SELECT y.inputtime FROM sys_user_assign y WHERE y.linktype = 'J' AND y.roletype = 'D' AND y.linkid = t.shipid AND COALESCE(y.isdelete,false) = false limit 1)  AS docnametime
			,(SELECT sono FROM bus_shipping WHERE isdelete = FALSE AND jobid = t.id) AS sono
			,(SELECT pono FROM bus_shipping WHERE isdelete = FALSE AND jobid = t.id) AS pono
			,(SELECT dategatein FROM bus_shipping WHERE isdelete = FALSE AND jobid = t.id) AS dategatein
			,(SELECT SUM(amount) FROM fina_arap WHERE isdelete = FALSE AND araptype = 'AR' AND jobid = t.id AND currency = 'USD') AS amountarusd
			,(SELECT SUM(amount) FROM fina_arap WHERE isdelete = FALSE AND araptype = 'AP' AND jobid = t.id AND currency = 'USD') AS amountapusd
			,(SELECT SUM(amount) FROM fina_arap WHERE isdelete = FALSE AND araptype = 'AR' AND jobid = t.id AND currency = 'CNY') AS amountarcny
			,(SELECT SUM(amount) FROM fina_arap WHERE isdelete = FALSE AND araptype = 'AP' AND jobid = t.id AND currency = 'CNY') AS amountapcny
			,(SELECT SUM(CASE currency WHEN 'CNY' THEN amount ELSE f_amtto_glp(arapdate::DATE, currency, amount) END) FROM fina_arap WHERE isdelete = FALSE AND araptype = 'AR' AND jobid = t.id) AS amountar
			,(SELECT SUM(CASE currency WHEN 'CNY' THEN amount ELSE f_amtto_glp(arapdate::DATE, currency, amount) END) FROM fina_arap WHERE isdelete = FALSE AND araptype = 'AP' AND jobid = t.id) AS amountap
			,(SELECT string_agg((c.sono)::text, ','::text) AS string_agg FROM bus_ship_container c WHERE (((((c.jobid = t.id) AND (c.isdelete = false)) AND (c.cntno IS NOT NULL)) AND ((c.cntno)::text <> ''::text)) AND (c.parentid IS NULL))) AS sonoss
			,(CASE WHEN t.cargotype = 'A' THEN '自揽货' WHEN t.cargotype = 'B' THEN '自揽同行' WHEN t.cargotype = 'C' THEN '指定货' WHEN t.cargotype = 'D' THEN '代订舱' ELSE '' END) AS cargotypename
			,(SELECT x.name FROM sys_department x  WHERE ((x.isdelete = false) AND (x.id = (select deptid from sys_user where id =t.saleid)))) AS depter2
			,(SELECT d.namec FROM dat_filedata AS d   WHERE d.isleaf = TRUE AND d.isdelete = false AND d.fkcode = 95 AND d.code = (select customertype from sys_corporation where id =t.customerid limit 1)) AS customertypenamec
			,(SELECT namec||'/'||namee||'/'||COALESCE((SELECT name FROM sys_department WHERE id = x.deptid),'') FROM sys_user x WHERE id = (SELECT priceuserid FROM bus_shipping WHERE isdelete = FALSE AND jobid = t.id limit 1)) as priceuser
		 	,(SELECT namee FROM dat_filedata d WHERE  d.isleaf = TRUE AND d.isdelete = false AND d.fkcode = 20 and code= ( SELECT bs.freightitem FROM bus_shipping bs WHERE bs.isdelete = FALSE AND bs.jobid = T.ID limit 1) limit 1) as freightitemnamec
		 	,(SELECT namee FROM dat_filedata d WHERE  d.isleaf = TRUE AND d.isdelete = false AND d.fkcode = 20 and code= ( SELECT bs.paymentitem FROM bus_shipping bs WHERE bs.isdelete = FALSE AND bs.jobid = T.ID limit 1) limit 1) as paymentitemnamec
		 	,(select b.iscomplete_loss from fina_jobs b  where b.id = t.id) AS iscomplete_loss
		 	,(SELECT cneetitlembl FROM bus_shipping WHERE isdelete = FALSE AND jobid = t.id)	as cneetitlembl
		 	,(SELECT (CASE WHEN isexternalmatching = 'F' THEN '自采' ELSE '外配' END) FROM bus_shipping WHERE isdelete = FALSE AND jobid = t.id)	as isexternalmatching
		 	,(SELECT (select namec from sys_user where isdelete = false and id = cusalesid limit 1) FROM fina_jobs fj WHERE fj.id = t.id AND isdelete = FALSE) as cusalesnamec
		 FROM(
				select
				 t.*
				 ,(CASE 
					WHEN NOT EXISTS (SELECT 1 FROM fina_arap WHERE isdelete = false AND araptype = 'AR' AND jobid = t.id)  THEN '无应收'
					WHEN (SELECT sum(amount-COALESCE(amtstl2,0)) = 0  FROM fina_arap WHERE isdelete = false AND araptype = 'AR' AND jobid = t.id ) THEN '已收款'
					WHEN (SELECT COALESCE(SUM(amtstl2),0) = 0 FROM fina_arap WHERE isdelete = false AND araptype = 'AR' AND jobid = t.id) THEN '未收款'
					ELSE '部分收款'
					END) AS arstatus2
				,(CASE 
					WHEN NOT EXISTS (SELECT 1 FROM fina_arap WHERE isdelete = false AND araptype = 'AP' AND jobid = t.id)  THEN '无应付'
					WHEN (SELECT sum(amount-COALESCE(amtstl2,0)) = 0  FROM fina_arap WHERE isdelete = false AND araptype = 'AP' AND jobid = t.id ) THEN '已付款'
					WHEN (SELECT COALESCE(SUM(amtstl2),0) = 0 FROM fina_arap WHERE isdelete = false AND araptype = 'AP' AND jobid = t.id) THEN '未付款'
					ELSE '部分付款'
					END) AS apstatus2
				,(SELECT string_agg(x.namec,',') FROM sys_user x , sys_user_assign y WHERE x.id =y.userid AND y.roletype = 'O' AND y.linkid = (SELECT id from bus_shipping s WHERE jobid = t.id AND isdelete =FALSE limit 1)  AND x.corpid = ANY(SELECT corpid FROM sys_user_corplink WHERE userid = $sqlloguserid$ AND ischoose = true) AND COALESCE(y.isdelete,false) = false)  AS opname2
				,(SELECT STRING_AGG(abbr,',') FROM sys_corporation c WHERE c.isdelete = FALSE AND id = ANY(SELECT corpid FROM fina_corp WHERE jobid = t.id AND corpoptype = 'HY' AND isdelete = FALSE)) AS corpops
				FROM _fina_jobs t
				WHERE $qry$
					$filter$
					AND jobtype = 'S'
					AND $icare$
					AND $carryitem$
					AND $sonoselect$
					AND $dynamicClauseWhere$
					$setDays$
					$corpfilter$
					$sqlpriceuser$
					AND isdelete = FALSE
					$ordersql$
					LIMIT $limit$ OFFSET $start$
			) AS T
		 ]]>
	</select>
	<select id="pages.module.ship.jobsBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(1) AS counts
		FROM _fina_jobs t
		WHERE $qry$
			$filter$
			AND $icare$
			AND $carryitem$
			AND $sonoselect$
			AND $dynamicClauseWhere$
			$setDays$
			 $corpfilter$
			 $sqlpriceuser$
			AND isdelete = FALSE
			AND jobtype = 'S'
	</select>

	<select id="pages.module.ship.shippingholdBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM _fina_jobs_shipinghold t
		WHERE $qry$
			AND jobtype = 'S'
			AND isdelete = FALSE
		ORDER BY jobdate DESC
	</select>
	<select id="pages.module.ship.shippingholdBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM _fina_jobs_shipinghold t
		WHERE $qry$
			AND isdelete = FALSE
			AND jobtype = 'S'
	</select>

	<select id="pages.module.ship.busshipholdBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM _bus_ship_hold t
		WHERE $qry$
		ORDER BY inputtime DESC
	</select>
	<select id="pages.module.ship.busshipholdBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM _bus_ship_hold t
		WHERE $qry$
	</select>


	<select id="pages.module.ship.shippingholduseBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
			select
		 *
		FROM _fina_jobs_shipinghold t
		WHERE $qry$
			AND jobtype = 'S'
			AND isdelete = FALSE
		ORDER BY eta DESC
	</select>
	<select id="pages.module.ship.shippingholduseBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM _fina_jobs_shipinghold t
		WHERE $qry$
			AND isdelete = FALSE
			AND jobtype = 'S'
	</select>





	<select id="pages.module.ship.jobspodBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		  t.id
		 ,t.nextid
		 ,t.genjobstype
		 ,t.nos
		 ,t.chnos
		 ,t.chid
		 ,t.mainnos
		 ,t.nextnos
		 ,t.customerabbr
		 ,t.saledesc
		 ,t.cntnos
		 ,t.sonos
		 ,t.refno
		 ,t.jobdate
		 ,t.islock
		 ,t.isclose
		 ,t.ischeck
		 ,t.iscomplete
		 ,t.isshipping
		 ,t.isair
		 ,t.istruck
		 ,t.iscus
		 ,t.istruckagent
		 ,t.isclc
		 ,t.isconfirmrpt
		 ,t.isconfirmrpt_user
		 ,t.isconfirmrpt_time
		 ,t.isconfirm_pp
		 ,t.confirm_pp_user
		 ,t.confirm_pp_time
		 ,t.isconfirm2_pp
		 ,t.confirm2_pp_user
		 ,t.confirm2_pp_time
		 ,t.isconfirm_cc
		 ,t.confirm_cc_user
		 ,t.confirm_cc_time
		 ,t.isconfirm2_cc
		 ,t.confirm2_cc_user
		 ,t.confirm2_cc_time
		 ,t.iscomplete_ar
		 ,t.complete_ar_user
		 ,t.complete_ar_time
		 ,t.iscomplete_ap
		 ,t.complete_ap_user
		 ,t.complete_ap_time
		 ,t.inputer
		 ,t.inputtime
		 ,t.updater
		 ,t.updatetime
		 ,t.jobdate
		 ,t.shipid

		FROM _fina_jobs t
		WHERE $qry$
		AND (jobtype = 'F'  OR jobtype = 'I')
		AND $icare$
		AND isdelete = FALSE
		ORDER BY inputtime desc

	</select>
	<select id="pages.module.ship.jobspodBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT
		 count(*) AS counts
		FROM _fina_jobs t
		WHERE $qry$
		AND $icare$
		AND isdelete = FALSE
		AND (jobtype = 'F'  OR jobtype = 'I')
	</select>


	<select id="pages.module.ship.jobslclBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT
		 *
		FROM _fina_jobs t
		WHERE $qry$
			$filter$
			AND jobtype = 'B'
			AND isdelete = FALSE
		ORDER BY inputtime DESC
	</select>
	<select id="pages.module.ship.jobslclBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT
		 count(*) AS counts
		FROM _fina_jobs t
		WHERE $qry$
			$filter$
			AND jobtype = 'B'
			AND isdelete = FALSE
	</select>


	<select id="pages.module.ship.jobslclcheckBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM _fina_jobs t
		WHERE $qry$
		AND jobtype = 'B'
		$filter$
		AND isdelete = FALSE
		AND isubmit = TRUE
		ORDER BY checktime DESC
	</select>
	<select id="pages.module.ship.jobslclcheckBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM _fina_jobs t
		WHERE $qry$
		$filter$
		AND isdelete = FALSE
		AND jobtype = 'B'
		AND isubmit = TRUE
	</select>


		<select id="pages.module.ship.jobsplitBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		  t.id
		   ,t.chnos
		 ,t.chid
		 ,t.nextid

		 ,t.genjobstype
		 ,t.nos
		 ,t.mainnos
		 ,t.nextnos
		 ,t.customerabbr
		 ,t.saledesc
		 ,t.cntnos
		 ,t.sonos
		 ,t.refno
		 ,t.jobdate
		 ,t.islock
		 ,t.isclose
		 ,t.ischeck
		 ,t.iscomplete
		 ,t.isshipping
		 ,t.isair
		 ,t.istruck
		 ,t.iscus
		 ,t.istruckagent
		 ,t.isclc
		 ,t.isconfirmrpt
		 ,t.isconfirmrpt_user
		 ,t.isconfirmrpt_time
		 ,t.isconfirm_pp
		 ,t.confirm_pp_user
		 ,t.confirm_pp_time
		 ,t.isconfirm2_pp
		 ,t.confirm2_pp_user
		 ,t.confirm2_pp_time
		 ,t.isconfirm_cc
		 ,t.confirm_cc_user
		 ,t.confirm_cc_time
		 ,t.isconfirm2_cc
		 ,t.confirm2_cc_user
		 ,t.confirm2_cc_time
		 ,t.iscomplete_ar
		 ,t.complete_ar_user
		 ,t.complete_ar_time
		 ,t.iscomplete_ap
		 ,t.complete_ap_user
		 ,t.complete_ap_time
		 ,t.inputer
		 ,t.inputtime
		 ,t.updater
		 ,t.updatetime
		 ,t.jobdate
		  ,t.shipid
		FROM _fina_jobs t
		WHERE $qry$
		AND (jobtype = 'F'  OR jobtype = 'I')
		AND $icare$
		AND isdelete = FALSE
		ORDER BY ordenos,mainnos desc
	</select>
	<select id="pages.module.ship.jobsplitBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT
		 count(*) AS counts
		FROM _fina_jobs t
		WHERE $qry$
		AND $icare$
		AND isdelete = FALSE
		AND (jobtype = 'F'  OR jobtype = 'I')
	</select>


	<select id="pages.module.ship.jobschildBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">

		SELECT DISTINCT t.*,(SELECT b.mblno FROM bus_shipping b WHERE b.jobid = t.id AND b.isdelete = false) AS mblno
				,(SELECT b.hblno FROM bus_shipping b WHERE b.jobid = t.id AND b.isdelete = false) AS hblno
				,(SELECT s.name FROM sys_department s WHERE s.id = t.deptid) AS name FROM(
									<!-- down  -->
									(WITH RECURSIVE  cte  AS  (
																SELECT a.*
																       ,(SELECT SUM(grswgt) FROM bus_ship_container c WHERE c.jobid = a.id AND c.isdelete = FALSE AND c.parentid IS NULL) AS grswgts
																       ,(SELECT SUM(cbm) FROM bus_ship_container c WHERE c.jobid = a.id AND c.isdelete = FALSE AND c.parentid IS NULL) AS cbms
																       ,(SELECT SUM(piece) FROM bus_ship_container c WHERE c.jobid = a.id AND c.isdelete = FALSE AND c.parentid IS NULL) AS pieces
																       ,(SELECT SUM(netcbm) FROM bus_ship_container c WHERE c.jobid = a.id AND c.isdelete = FALSE AND c.parentid IS NULL) AS netcbm
																       ,(SELECT string_agg(DISTINCT markno,',') FROM bus_ship_container c WHERE c.jobid = a.id AND c.isdelete = FALSE AND c.parentid IS NULL AND COALESCE(c.markno,'') !='' ) AS markno
																       ,(SELECT nos from fina_jobs where id = a.parentid) AS mainnos
																       ,(SELECT id from fina_jobs where id = a.parentid) AS mainid
																       FROM fina_jobs a WHERE $child$
															    UNION ALL
																SELECT k.*
																,(SELECT SUM(grswgt) FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE AND c.parentid IS NULL) AS grswgts
																,(SELECT SUM(cbm) FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE AND c.parentid IS NULL) AS cbms
																,(SELECT SUM(piece) FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE AND c.parentid IS NULL) AS pieces
																,(SELECT SUM(netcbm) FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE AND c.parentid IS NULL) AS netcbm
																,(SELECT string_agg(DISTINCT markno,',') FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE AND c.parentid IS NULL AND COALESCE(c.markno,'') !='' ) AS markno
																,(SELECT nos from fina_jobs where id = k.parentid) AS mainnos
																,(SELECT id from fina_jobs where id = k.parentid) AS mainid
																 from fina_jobs k INNER JOIN cte c on c.id = k.parentid
															)SELECT * FROM cte
									)

									UNION ALL
									<!-- up  -->
									(WITH RECURSIVE cte  AS (
																SELECT a.*
																,(SELECT SUM(grswgt) FROM bus_ship_container c WHERE c.jobid = a.id AND c.isdelete = FALSE AND c.parentid IS NULL) AS grswgts
																,(SELECT SUM(cbm) FROM bus_ship_container c WHERE c.jobid = a.id AND c.isdelete = FALSE AND c.parentid IS NULL) AS cbms
																,(SELECT SUM(piece) FROM bus_ship_container c WHERE c.jobid = a.id AND c.isdelete = FALSE AND c.parentid IS NULL) AS pieces
																,(SELECT SUM(netcbm) FROM bus_ship_container c WHERE c.jobid = a.id AND c.isdelete = FALSE AND c.parentid IS NULL) AS netcbm
																,(SELECT string_agg(DISTINCT markno,',') FROM bus_ship_container c WHERE c.jobid = a.id AND c.isdelete = FALSE AND c.parentid IS NULL AND COALESCE(c.markno,'') !='' ) AS markno
																,(SELECT nos from fina_jobs where id = a.parentid) AS mainnos
																,(SELECT id from fina_jobs where id = a.parentid) AS mainid
																FROM fina_jobs a WHERE $child$
															UNION ALL
																SELECT k.*
																,(SELECT SUM(grswgt) FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE AND c.parentid IS NULL) AS grswgts
																,(SELECT SUM(cbm) FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE AND c.parentid IS NULL) AS cbms
														        ,(SELECT SUM(piece) FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE AND c.parentid IS NULL) AS pieces
														        ,(SELECT SUM(netcbm) FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE AND c.parentid IS NULL) AS netcbm
														        ,(SELECT string_agg(DISTINCT markno,',') FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE AND c.parentid IS NULL AND COALESCE(c.markno,'') !='' ) AS markno
														        ,(SELECT nos from fina_jobs where id = k.parentid) AS mainnos
																,(SELECT id from fina_jobs where id = k.parentid) AS mainid
																from fina_jobs k INNER JOIN cte c on k.id = c.parentid
															)SELECT * from cte
									)UNION ALL
									<!-- 电商订单查找-->
									SELECT k.*
									, (SELECT SUM(grswgt) FROM bus_packlist c WHERE c.linkid = k.id)                                                       AS grswgts
									, (SELECT SUM(cbm) FROM bus_packlist c WHERE c.linkid = k.id)                                                          AS cbms
									, (SELECT SUM(piece) FROM bus_packlist c WHERE c.linkid = k.id)                                                        AS pieces
									, (SELECT SUM(cbm) FROM bus_packlist c WHERE c.linkid = k.id)                                                          AS netcbm
									, (SELECT string_agg(DISTINCT markno, ',') FROM bus_packlist c WHERE c.linkid = k.id AND COALESCE(c.markno, '') != '') AS markno
									, (SELECT nos from fina_jobs where id = k.parentid)                                                                    AS mainnos
									, (SELECT id from fina_jobs where id = k.parentid)                                                                     AS mainid
									FROM fina_jobs k WHERE parentid = $parentid$ AND isdelete = FALSE
									UNION ALL
									<!-- 平级查找-->
									SELECT k.*
									,(SELECT SUM(grswgt) FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE AND c.parentid IS NULL) AS grswgts
						            ,(SELECT SUM(cbm) FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE AND c.parentid IS NULL) AS cbms
									,(SELECT SUM(piece) FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE AND c.parentid IS NULL) AS pieces
									,(SELECT SUM(netcbm) FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE AND c.parentid IS NULL) AS netcbm
									,(SELECT string_agg(DISTINCT markno,',') FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE AND c.parentid IS NULL AND COALESCE(c.markno,'') !='' ) AS markno
									,(SELECT nos from fina_jobs where id = k.parentid) AS mainnos
								    ,(SELECT id from fina_jobs where id = k.parentid) AS mainid
									 FROM fina_jobs k WHERE parentid = $parentid$ AND $child2$ AND isdelete = FALSE

						    )AS t
		WHERE $qry$
		$sql3$
		ORDER BY nos
	</select>
	<select id="pages.module.ship.jobschildBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 CAST(10 AS BIGINT) AS counts
		FROM  _fina_jobschild t

	</select>




	<select id="pages.module.ship.jobschildsplitBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">

		SELECT DISTINCT t.*,(SELECT s.name FROM sys_department s WHERE s.id = t.deptid) AS name FROM(
									<!-- down  -->
									(WITH RECURSIVE cte AS(
																SELECT a.*
																       ,(SELECT SUM(grswgt) FROM bus_ship_container c WHERE c.jobid = a.id AND c.isdelete = FALSE) AS grswgts
																       ,(SELECT SUM(cbm) FROM bus_ship_container c WHERE c.jobid = a.id AND c.isdelete = FALSE) AS cbms
																       ,(SELECT SUM(piece) FROM bus_ship_container c WHERE c.jobid = a.id AND c.isdelete = FALSE) AS pieces
																       FROM _fina_jobs a WHERE $child$
															UNION ALL
																SELECT k.*
																,(SELECT SUM(grswgt) FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE) AS grswgts
																,(SELECT SUM(cbm) FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE) AS cbms
																,(SELECT SUM(piece) FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE) AS pieces
																 from _fina_jobs k INNER JOIN cte c on c.id = k.parentid
															)SELECT * FROM cte
									)

									UNION ALL
									<!-- up  -->
									(WITH RECURSIVE cte AS(
																SELECT a.*
																,(SELECT SUM(grswgt) FROM bus_ship_container c WHERE c.jobid = a.id AND c.isdelete = FALSE) AS grswgts
																,(SELECT SUM(cbm) FROM bus_ship_container c WHERE c.jobid = a.id AND c.isdelete = FALSE) AS cbms
																,(SELECT SUM(piece) FROM bus_ship_container c WHERE c.jobid = a.id AND c.isdelete = FALSE) AS pieces
																FROM _fina_jobs a WHERE $child$
															UNION ALL
																SELECT k.*
																,(SELECT SUM(grswgt) FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE) AS grswgts
																,(SELECT SUM(cbm) FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE) AS cbms
														        ,(SELECT SUM(piece) FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE) AS pieces
																from _fina_jobs k INNER JOIN cte c on k.id = c.parentid
															)SELECT * from cte
									)UNION ALL


									<!-- 平级查找-->

									SELECT k.*
									,(SELECT SUM(grswgt) FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE) AS grswgts
						            ,(SELECT SUM(cbm) FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE) AS cbms
									,(SELECT SUM(piece) FROM bus_ship_container c WHERE c.jobid = k.id AND c.isdelete = FALSE) AS pieces
									 FROM _fina_jobs k WHERE parentid = (SELECT parentid FROM _fina_jobs a WHERE $child$ AND isdelete = FALSE ) AND $child2$ AND isdelete = FALSE




						    )AS t
		WHERE $qry$
		ORDER BY  nos
	</select>
	<select id="pages.module.ship.jobschildsplitBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 CAST(10 AS BIGINT) AS counts
		FROM  _fina_jobschild t

	</select>




	<select id="pages.module.ship.jobschildpodBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">

		SELECT DISTINCT t.*,(SELECT s.name FROM sys_department s WHERE s.id = t.deptid) AS name FROM(
									<!-- down  -->
									(WITH RECURSIVE cte AS(
																SELECT a.* FROM _fina_jobs a WHERE $child$
															UNION ALL
																SELECT k.* from _fina_jobs k INNER JOIN cte c on c.id = k.parentid
															)SELECT * FROM cte
									)

									UNION ALL
									<!-- up  -->
									(WITH RECURSIVE cte AS(
																SELECT a.* FROM _fina_jobs a WHERE $child$
															UNION ALL
																SELECT k.* from _fina_jobs k INNER JOIN cte c on k.id = c.parentid
															)SELECT * from cte
									)UNION ALL

									<!-- 平级查找-->

									SELECT a.* FROM _fina_jobs a WHERE parentid = (SELECT parentid FROM _fina_jobs WHERE $child$ AND isdelete = FALSE ) AND $child2$ AND isdelete = FALSE

						    )AS t
		WHERE $qry$
		ORDER BY nos
	</select>
	<select id="pages.module.ship.jobschildpodBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 CAST(10 AS BIGINT) AS counts
		FROM  _fina_jobschild t

	</select>


	<select id="pages.module.ship.busshipcontainerBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM  bus_ship_container t
		WHERE $qry$
	</select>
	<select id="pages.module.ship.busshipcontainerBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM  bus_ship_container t
		WHERE $qry$
	</select>

	<select id="pages.module.ship.busshipbillBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.inputer and x.isdelete = false limit 1),t.inputer) AS inputername
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.updater and x.isdelete = false limit 1),t.updater) AS updatername
		 ,f_bus_ship_bill_cntdesc('billid='||t.id) AS cntdesc
		 ,(SELECT String_agg(cntno,',') FROM bus_ship_container WHERE isdelete = FALSE AND ((t.bltype = 'H' AND billid = t.id AND jobid=t.jobid) OR (t.bltype = 'M' AND billmblid = t.id AND jobid=t.jobid))) AS cntnos
		FROM  _bus_ship_bill t
		WHERE $qry$
		AND isdelete = FALSE
		ORDER BY hblno
	</select>
	<select id="pages.module.ship.busshipbillBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM  _bus_ship_bill t
		WHERE $qry$
		AND isdelete = FALSE
	</select>

	<!--
	<select id="pages.module.ship.busshippingBean.gridbooking.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
	FROM  _bus_booking_choose t
	WHERE $qry$
	AND $qry2$
	UNION ALL
	select
		 *
	FROM  _bus_booking_choose t
	WHERE  $qry$
	AND $qry3$
	UNION ALL
	select
		 *
	FROM  _bus_booking_choose t
	WHERE  $qry$
	AND t.bookstate= 'I'
	</select>
	<select id="pages.module.ship.busshippingBean.gridbooking.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT count(*) AS counts FROM(
		select
		 *
		FROM  _bus_booking_choose t
		WHERE $qry$
		AND $qry2$
		UNION ALL
		select
			 *
		FROM  _bus_booking_choose t
		WHERE  $qry$
		AND $qry3$
		UNION ALL
		select
			 *
		FROM  _bus_booking_choose t
		WHERE  $qry$
		AND t.bookstate= 'I'
		)AS t
	</select>

	  -->


	<select id="pages.module.ship.busshippingBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 row_number() OVER() AS row
		 ,*
		 ,COALESCE(piece,0) AS piece2
		 ,COALESCE(grswgt,0) AS grswgt2
		 ,COALESCE(cbm,0) AS cbm2
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.inputer and x.isdelete = false limit 1),t.inputer) AS inputername
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.updater and x.isdelete = false limit 1),t.updater) AS updatername
		FROM  _bus_ship_container t
		WHERE $qry$
			$filter$
			AND parentid IS NULL
			AND isdelete = false
		ORDER BY orderno,ldtypedesc,cntypedesc,sono,cntno
		LIMIT $limit$ OFFSET $start$
	</select>
	<select id="pages.module.ship.busshippingBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM  _bus_ship_container t
		WHERE $qry$
			$filter$
			AND parentid IS NULL
			AND isdelete = false
	</select>


	<select id="pages.module.ship.shipbusgoodschooseBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM  _bus_ship_container t
		WHERE $qry$
		AND parentid IS NULL
		AND isdelete = false
	</select>
	<select id="pages.module.ship.shipbusgoodschooseBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM  _bus_ship_container t
		WHERE $qry$
		AND parentid IS NULL
		AND isdelete = false
	</select>

	<select id="pages.module.ship.busshippingpodBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM  _bus_ship_container t
		WHERE $qry$
		AND isdelete = false
	</select>
	<select id="pages.module.ship.busshippingpodBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM  _bus_ship_container t
		WHERE $qry$
	</select>


	<select id="pages.module.ship.busshippinglclcheckBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM  _bus_ship_container t
		WHERE $qry$
		AND isdelete = false
	</select>
	<select id="pages.module.ship.busshippinglclcheckBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM  _bus_ship_container t
		WHERE $qry$
	</select>

	<select id="pages.module.ship.busshippinglclBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM  _bus_ship_container t
		WHERE $qry$
		AND isdelete = false
	</select>
	<select id="pages.module.ship.busshippinglclBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM  _bus_ship_container t
		WHERE $qry$
	</select>


	<select id="pages.module.ship.busshipbilleditBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.inputer and x.isdelete = false limit 1),t.inputer) AS inputername
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.updater and x.isdelete = false limit 1),t.updater) AS updatername
		FROM  _bus_ship_container t
		WHERE $qry$
			$filter$
			AND isdelete = false
			AND NOT exists(SELECT 1 FROM bus_ship_container x where x.parentid = t.id and x.isdelete = false and x.jobid = t.jobid)
		ORDER BY $order$
		LIMIT $limit$ OFFSET $start$
	</select>

	<select id="pages.module.ship.busshipbilleditBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM  _bus_ship_container t
		WHERE $qry$
			$filter$
			AND NOT exists(SELECT 1 FROM bus_ship_container x where x.parentid = t.id and x.isdelete = false and x.jobid = t.jobid)
			AND isdelete = false
	</select>

	<select id="pages.module.ship.senddocBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM  bus_docexp t
		WHERE $qry$
		ORDER BY inputtime DESC
	</select>
	<select id="pages.module.ship.senddocBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM  bus_docexp t
		WHERE $qry$
	</select>

	<select id="pages.module.ship.senddocchooseBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM  _bus_docexp_link t
		WHERE $qry$
		 ORDER BY joinnos ,shipnos DESC
	</select>
	<select id="pages.module.ship.senddocchooseBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM _bus_docexp_link t
		WHERE $qry$
	</select>


	<select id="pages.module.ship.shipchooseBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM  _bus_docchoose t
		WHERE $qry$
	</select>
	<select id="pages.module.ship.shipchooseBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM _bus_docchoose t
		WHERE $qry$
	</select>

	<select id="pages.module.ship.senddocdefineBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM  _bus_docdefine t
		WHERE $qry$
		ORDER BY jobno , code
	</select>
	<select id="pages.module.ship.senddocdefineBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM _bus_docdefine t
		WHERE $qry$
	</select>

	<select id="pages.module.ship.unionBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		 ,(select abbr from sys_corporation where isdelete = false AND id = t.carrierid) AS carrierdesc
		 ,(SELECT string_agg(c.nos,',') from _bus_shipjoinlink c where c.shipjoin = t.id) AS shipnos
		FROM  _bus_shipjoin t
		WHERE $qry$
		AND isdelete = FALSE
		order by singtime DESC
		LIMIT $limit$ OFFSET $start$
	</select>
	<select id="pages.module.ship.unionBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM _bus_shipjoin t
		WHERE $qry$
		AND isdelete = FALSE
	</select>



	<select id="pages.module.ship.loadBillMergeBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		<!--工作单号，工作单日期，业务员，参考号，委托人中文名，业务员，MBL HBL ，SO ，箱号 ，装箱，进出口，收款状态，付款状态，发票状态，发货人，收货人，通知人，目的港代理 工作单类型（jobtype），-->
		SELECT row_number() OVER() AS row,* FROM(
		SELECT t.id,t.nos,t.jobdate,t.inputtime,bs.sono,bs.mblno,bs.vessel,bs.voyage
		,(SELECT namec||'/'||namee||'/'||COALESCE((SELECT name FROM sys_department WHERE id = x.deptid),'') FROM sys_user x WHERE id = t.saleid) AS saledesc
		,t.refno
		,(SELECT (CASE WHEN COALESCE(namec,'') = '' THEN namee ELSE namec END) FROM sys_corporation WHERE id = t.customerid) AS customernamec
		,t.ldtype
		,t.impexp
		,(SELECT COALESCE(d.namee,d.namec) FROM dat_filedata AS d WHERE d.isleaf = TRUE AND d.isdelete = false AND d.fkcode = 170 AND d.code = t.impexp LIMIT 1) AS impexpv
		,t.arstatus
		,t.apstatus
		,t.invstatus
		,t.jobtype
		,(CASE  t.jobtype WHEN 'S' THEN '海运' WHEN 'A' THEN '空运' WHEN 'L' THEN '陆运' WHEN 'C' THEN '报关' END) AS jobtypev
		,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.inputer and x.isdelete = false limit 1),t.inputer) AS inputername
		,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.updater and x.isdelete = false limit 1),t.updater) AS updatername
		,t.inputtime
		,t.updatetime
		,(SELECT (CASE WHEN COALESCE(abbr,'') = '' THEN namec ELSE abbr END) FROM sys_corporation WHERE id = t.customerid) AS customerabbr
		,(SELECT abbr FROM sys_corporation WHERE id = t.corpidop AND isdelete = FALSE) AS opcompany
		,(SELECT abbr FROM sys_corporation WHERE id = t.corpid AND isdelete = FALSE) AS company
		,(SELECT f_fina_jobs_cnts('jobid='::text||t.id)) AS cnts
		FROM fina_jobs t
		LEFT JOIN bus_shipping bs on t.id=bs.jobid
		WHERE $qry$
		$filter$
		$corpfilter$
		$dynamicClauseWhere$
		AND t.isdelete = FALSE
		AND t.jobtype = 'S'
		AND t.jobdate > '2020-10-31'
		ORDER BY jobdate DESC,t.nos DESC
		) AS T
		LIMIT $limit$ OFFSET $start$
	</select>
	<select id="pages.module.ship.loadBillMergeBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT
			count(*) AS counts
		FROM fina_jobs t
		WHERE $qry$
			$filter$
			$corpfilter$
			$dynamicClauseWhere$
			AND isdelete = FALSE
			AND t.jobtype = 'S'
			AND t.jobdate > '2020-10-31'
	</select>



	<select id="pages.module.ship.shipjoinlinkchooseBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM  _bus_shipjoinlinkchoose t
		WHERE $qry$
		order by  nos
	</select>
	<select id="pages.module.ship.shipjoinlinkchooseBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM _bus_shipjoinlinkchoose t
		WHERE $qry$
	</select>

	<select id="pages.module.ship.shipjoinlinkBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		  *
		 ,(SELECT b.isprintlock FROM bus_ship_container s,bus_ship_bill b WHERE t.containerid = s.id AND s.billid = b.id AND s.isdelete = FALSE AND b.isdelete = FALSE)AS isprintlock
		FROM  _bus_shipjoinlink t
		WHERE $qry$
		order by nos
	</select>
	<select id="pages.module.ship.shipjoinlinkBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM _bus_shipjoinlink t
		WHERE $qry$
	</select>

	<select id="pages.module.ship.busshipjoingoodsBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
			select
			id, shipjoin, goodsname,
			coalesce((select case when t.hscode != '' or t.hscode != null then t.hscode
			    				  else (case when bsc.hscode != '' or bsc.hscode != null then bsc.hscode else '' end) end
			    from bus_shipjoinlink x, bus_ship_container bsc
				where x.shipid = bsc.shipid AND x.shipjoin = t.shipjoin AND bsc.isdelete = false
			    AND similarity(t.goodsname, bsc.goodsnamee) > 0.3 LIMIT 1), t.hscode) as hscode
			FROM  bus_shipjoingoods t
		WHERE $qry$
		order by shipjoin
	</select>
	<select id="pages.module.ship.busshipjoingoodsBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM bus_shipjoingoods t
		WHERE $qry$
	</select>

	<select id="pages.module.ship.shipmsgboardBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM _sys_msgboard t
		WHERE $qry$
		AND parentid is null
		ORDER BY inputtime DESC
	</select>
	<select id="pages.module.ship.shipmsgboardBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM _sys_msgboard t
		WHERE $qry$
		AND parentid is null
	</select>

	<select id="pages.module.ship.shipjobschooseBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM _fina_jobs t
		WHERE $qry$
		AND isdelete = FALSE
		AND jobtype = 'S'
		AND ldtype = 'L' AND ldtype2 IN('D','B','C','S','F','O','A')
		ORDER BY jobdate desc
	</select>
	<select id="pages.module.ship.shipjobschooseBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM _fina_jobs t
		WHERE $qry$
		AND isdelete = FALSE
		AND jobtype = 'S'
		AND ldtype = 'L' AND ldtype2 IN('D','B','C','S','F','O')
	</select>

	<select id="pages.module.ship.shipbillcopychooseBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM  _bus_shipbillcopychoose t
		WHERE $qry$
			AND (t.bltype ='M' OR t.bltype ='H')
			AND t.isdelete = FALSE
		ORDER BY t.inputtime DESC
	</select>
	<select id="pages.module.ship.shipbillcopychooseBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM _bus_shipbillcopychoose t
		WHERE $qry$
		AND t.isdelete = FALSE
	</select>

	<select id="pages.module.ship.shipbillcopychoosemblBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM  _bus_shipbillcopychoose t
		WHERE $qry$
			AND (t.bltype ='M' OR t.bltype ='H')
			AND t.isdelete = FALSE
		ORDER BY t.inputtime DESC
	</select>
	<select id="pages.module.ship.shipbillcopychoosemblBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM _bus_shipbillcopychoose t
		WHERE $qry$
			AND (t.bltype ='M' OR t.bltype ='H')
			AND t.isdelete = FALSE
	</select>



	<select id="pages.module.ship.bookingBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 piece1,piece1,piece3,(piece4+piece5+piece6+piece7+piece8+piece9+piece10+piece11+piece12) AS pieceothers,*
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = b.inputer and x.isdelete = false limit 1),b.inputer) AS inputername
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = b.updater and x.isdelete = false limit 1),b.updater) AS updatername
		FROM  _bus_ship_booking b
		WHERE $qry$
		AND (userbook IS NOT NULL AND userbook != '')
		AND (orderno IS NOT NULL AND orderno != '')
		LIMIT $limit$ OFFSET $start$
	</select>
	<select id="pages.module.ship.bookingBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM _bus_ship_booking b
		WHERE $qry$
		AND (userbook IS NOT NULL AND userbook != '')
		AND (orderno IS NOT NULL AND orderno != '')
	</select>

	<select id="pages.module.ship.bookingeditBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM  _bus_ship_bookdtl t
		WHERE $qry$
	</select>
	<select id="pages.module.ship.bookingeditBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM _bus_ship_bookdtl t
		WHERE $qry$
	</select>

	<select id="pages.module.ship.shipbookingchooseBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT
			 *
		FROM  _bus_booking_choose t
		WHERE $qry$
		AND $qry2$
		AND (t.bookstate= 'A' OR t.bookstate= 'I')

		UNION ALL
		SELECT
			 *
		FROM  _bus_booking_choose t
		WHERE  $qry$
		AND $qry3$
		AND (t.bookstate= 'A' OR t.bookstate= 'I')

		UNION ALL
		SELECT
			 *
		FROM  _bus_booking_choose t
		WHERE  $qry$
		AND t.bookstate= 'I'
		AND (t.bookstate= 'A' OR t.bookstate= 'I')
	</select>
	<select id="pages.module.ship.shipbookingchooseBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT count(*) AS counts FROM(
			SELECT
			 *
			FROM  _bus_booking_choose t
			WHERE $qry$
			AND $qry2$
			AND (t.bookstate= 'A' OR t.bookstate= 'I')

			UNION ALL
			SELECT
				 *
			FROM  _bus_booking_choose t
			WHERE  $qry$
			AND $qry3$
			AND (t.bookstate= 'A' OR t.bookstate= 'I')

			UNION ALL
			SELECT
				 *
			FROM  _bus_booking_choose t
			WHERE  $qry$
			AND t.bookstate= 'I'
			AND (t.bookstate= 'A' OR t.bookstate= 'I')
		)AS t
	</select>



	<select id="pages.module.ship.shipscheduleBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM bus_shipschedule t
		WHERE $qry$
			AND isdelete = FALSE
			AND schtype = 'S'
		ORDER BY yearno DESC ,cls DESC ,etd DESC ,eta DESC, carrier , pol , pod DESC
		LIMIT $limit$ OFFSET $start$
	</select>
	<select id="pages.module.ship.shipscheduleBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM bus_shipschedule t
		WHERE $qry$
			AND isdelete = FALSE
			AND schtype = 'S'
	</select>


	<select id="pages.module.ship.shipcostBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM  _bus_ship_cost t
		WHERE $qry$
		AND isdelete = FALSE
		ORDER BY inputtime desc
	</select>
	<select id="pages.module.ship.shipcostBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM _bus_ship_cost t
		WHERE $qry$
	</select>

	<select id="pages.module.ship.shipcosteditBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		  ,(SELECT code FROM dat_cntype WHERE t.cntypeid = id AND isdelete = FALSE )AS cntdesc
		FROM  bus_ship_costdtl t
		WHERE $qry$
		AND isdelete = FALSE
		ORDER BY inputtime desc
	</select>
	<select id="pages.module.ship.shipcosteditBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM bus_ship_costdtl t
		WHERE $qry$
		AND isdelete = FALSE
	</select>


	<select id="pages.module.ship.shipcosteditBean.gridShipschedule.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM bus_shipschedule t
		WHERE $qry$
			AND isdelete = FALSE
			AND schtype = 'S'
		ORDER BY COALESCE(cls,inputtime) DESC ,yearno DESC,monthno DESC,weekno,etd,eta,carrier,pol,pod DESC
	</select>
	<select id="pages.module.ship.shipcosteditBean.gridShipschedule.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM bus_shipschedule t
		WHERE $qry$
			AND isdelete = FALSE
			AND schtype = 'S'
	</select>


	<select id="pages.module.ship.busshipdelayBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM bus_shipschedule t
		WHERE $qry$
			AND isdelete = FALSE
			AND schtype = 'S'
		ORDER BY yearno DESC , monthno DESC , carrier , pol , pod DESC
	</select>
	<select id="pages.module.ship.busshipdelayBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM bus_shipschedule t
		WHERE $qry$
			AND isdelete = FALSE
			AND schtype = 'S'
	</select>


	<select id="pages.module.ship.busshipdropcntBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM bus_shipschedule t
		WHERE $qry$
			AND isdelete = FALSE
			AND schtype = 'S'
		ORDER BY yearno DESC , monthno DESC , carrier , pol , pod DESC
	</select>
	<select id="pages.module.ship.busshipdropcntBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM bus_shipschedule t
		WHERE $qry$
			AND isdelete = FALSE
			AND schtype = 'S'
	</select>

	<!--
	<select id="pages.module.ship.unionapBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT *
		FROM _fina_arap
		WHERE $qry$
		AND jobid IN
			(WITH RECURSIVE cte AS(
			SELECT a.id FROM _fina_jobs a WHERE id IN (SELECT s.jobid FROM bus_shipping s,bus_shipjoinlink l WHERE s.isdelete = FALSE AND s.id = l.shipid AND $qry2$ )
			UNION ALL
			SELECT k.id from _fina_jobs k INNER JOIN cte c on c.id = k.parentid
			)SELECT * FROM cte
			)
		AND isdelete = FALSE
		AND araptype = 'AP'
		ORDER BY jobno,feeitemid
	</select>
	<select id="pages.module.ship.unionapBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT
		COUNT(*) AS counts
		FROM _fina_arap
		WHERE $qry$
		AND jobid IN
			(WITH RECURSIVE cte AS(
			SELECT a.id FROM _fina_jobs a WHERE id IN (SELECT s.jobid FROM bus_shipping s,bus_shipjoinlink l WHERE s.isdelete = FALSE  AND s.id = l.shipid AND $qry2$)
			UNION ALL
			SELECT k.id from _fina_jobs k INNER JOIN cte c on c.id = k.parentid
			)SELECT * FROM cte
			)
		AND isdelete = FALSE
		AND araptype = 'AP'
	</select>

	-->

	<select id="pages.module.ship.unionapBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT *
		FROM _fina_arap
		WHERE $qry$
		AND jobid IN(SELECT s.jobid FROM bus_shipping s,bus_shipjoinlink l WHERE s.isdelete = FALSE AND s.id = l.shipid AND $qry2$)
		AND isdelete = FALSE
		AND araptype = 'AP'
		AND (rptype = 'S' OR rptype = 'G')
		ORDER BY jobno,feeitemid
	</select>
	<select id="pages.module.ship.unionapBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT
		COUNT(*) AS counts
		FROM _fina_arap
		WHERE $qry$
		AND jobid IN(SELECT s.jobid FROM bus_shipping s,bus_shipjoinlink l WHERE s.isdelete = FALSE AND s.id = l.shipid AND $qry2$)
		AND isdelete = FALSE
		AND araptype = 'AP'
		AND (rptype = 'S' OR rptype = 'G')
	</select>


	<select id="pages.module.ship.delaydropcontBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT
			 *
		FROM  _bus_booking_choose t
		WHERE $qry$
	</select>

	<select id="pages.module.ship.delaydropcontBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT count(*) AS counts
		FROM  _bus_booking_choose t
		WHERE $qry$
	</select>

	<select id="pages.module.ship.delaydropcontBean.rightgrid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM bus_shipschedule t
		WHERE $qry$
			AND isdelete = FALSE
			AND schtype = 'S'
		ORDER BY yearno DESC , monthno DESC , carrier , pol , pod DESC

	</select>

	<select id="pages.module.ship.delaydropcontBean.rightgrid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		count(*) AS counts
		FROM bus_shipschedule t
		WHERE $qry$
			AND isdelete = FALSE
			AND schtype = 'S'

	</select>


	<select id="pages.module.ship.bookingeditBean.sysusergrid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM sys_user t
		WHERE $qry$
		AND isys = true
		ORDER BY code

	</select>
	<select id="pages.module.ship.bookingeditBean.sysusergrid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		count(*) AS counts
		FROM sys_user t
		WHERE $qry$
		AND isys = true
	</select>


	<select id="pages.module.ship.jobsislockBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.inputer and x.isdelete = false limit 1),t.inputer) AS inputername
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.updater and x.isdelete = false limit 1),t.updater) AS updatername
		FROM _fina_jobs t
		WHERE $qry$
			AND isdelete = FALSE
		ORDER BY ordenos,mainnos desc,nos
		LIMIT $limit$ OFFSET $start$
	</select>
	<select id="pages.module.ship.jobsislockBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM _fina_jobs t
		WHERE $qry$
			AND isdelete = FALSE
	</select>

	<select id="pages.module.ship.edi_nportBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM _fina_jobs t
		WHERE $qry$
			AND jobtype = 'S'
			AND isdelete = FALSE
		ORDER BY ordenos,mainnos desc,nos
	</select>
	<select id="pages.module.ship.edi_nportBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM _fina_jobs t
		WHERE $qry$
			AND isdelete = FALSE
			AND jobtype = 'S'
	</select>

	<select id="pages.module.ship.billregisterBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.inputer and x.isdelete = false limit 1),t.inputer) AS inputername
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.updater and x.isdelete = false limit 1),t.updater) AS updatername
		 ,regexp_replace(array((SELECT string_agg(x.namec,',') FROM sys_user x,sys_user_assign y WHERE y.isdelete = FALSE AND y.userid = x.id AND y.roletype = 'D' AND
				EXISTS(SELECT 1 FROM bus_shipping b WHERE b.isdelete = FALSE AND b.id = y.linkid AND b.hblno = t.billno))
				UNION ALL
				SELECT string_agg(x.namec,',') FROM sys_user x,sys_user_assign y WHERE y.isdelete = FALSE AND y.userid = x.id AND y.roletype = 'D' AND
				EXISTS(SELECT 1 FROM fina_jobs c, bus_shipping a,bus_ship_bill b WHERE a.isdelete = FALSE
				AND c.id = a.jobid AND a.isdelete = FALSE AND b.jobid = c.id AND b.isdelete = FALSE AND a.id = y.linkid AND b.hblno = t.billno))::TEXT,'{|}|"|NULL|(NULL,)|(,NULL)','','g') opentions

		 ,regexp_replace(array((SELECT string_agg(x.namec,',') FROM sys_user x WHERE EXISTS(SELECT 1 FROM fina_jobs a,bus_shipping b WHERE x.id = a.saleid AND b.jobid = a.id AND b.hblno = t.billno))
				UNION ALL
			 SELECT string_agg(x.namec,',') FROM sys_user x WHERE
				EXISTS(SELECT 1 FROM fina_jobs a,bus_ship_bill b WHERE a.isdelete = FALSE
				AND b.isdelete = FALSE AND x.id = a.saleid AND b.jobid = a.id AND b.hblno = t.billno))::TEXT,'{|}|"|NULL|(NULL,)|(,NULL)','','g') saless
		 ,regexp_replace(array((SELECT string_agg(x.abbr,',') FROM sys_corporation x WHERE EXISTS(SELECT 1 FROM fina_jobs a,bus_shipping b WHERE x.id = a.customerid AND b.jobid = a.id AND b.hblno = t.billno))
				UNION ALL
			SELECT string_agg(x.abbr,',') FROM sys_corporation x WHERE
				 EXISTS(SELECT 1 FROM fina_jobs a,bus_ship_bill b WHERE a.isdelete = FALSE AND b.isdelete = FALSE AND x.id = a.customerid AND b.jobid = a.id AND b.hblno = t.billno))::TEXT,'{|}|"|NULL|(NULL,)|(,NULL)','','g') corporation
		FROM bus_ship_bill_reg t
		WHERE $qry$
		ORDER BY inputtime DESC,billno
		LIMIT $limit$ OFFSET $start$
	</select>
	<select id="pages.module.ship.billregisterBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM _bus_ship_bill_reg t
		WHERE $qry$
	</select>

	<select id="pages.module.ship.buscustomstaxretBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM _bus_customs_taxret t
		WHERE $qry$
		ORDER BY id
	</select>
	<select id="pages.module.ship.buscustomstaxretBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM _bus_customs_taxret t
		WHERE $qry$
	</select>

	<select id="pages.module.ship.edi_mapBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM edi_map t
		WHERE $qry$
		ORDER BY orderno
	</select>
	<select id="pages.module.ship.edi_mapBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM edi_map t
		WHERE $qry$
	</select>

	<select id="pages.module.ship.businvoiceBean.grid.page"
		parameterClass="java.util.Map" resultClass="java.util.HashMap">
		WITH rc_arap AS(
			SELECT
				 a.id
				,(CASE WHEN a.invoiceid is not null then true else false end) AS ischoose
				,a.jobno
				,a.jobdate
				,a.araptype
				,a.ppcc
				,a.arapdate
				,a.feeitemdec
				,a.currency
				,a.amount
				,a.piece
				,a.price
				,a.feeitemid
				,a.invoiceid
				,a.customerid
				,a.isamend
				,(select zd.billno from fina_bill zd where zd.jobid=a.jobid LIMIT 1) AS billno
				,(CASE WHEN a.invoiceid IS NULL THEN (SELECT x.rate FROM _inv_exchangerate x WHERE x.currencyfm = a.currency AND x.currencyto = $cyto$ AND a.jobdate BETWEEN x.datafm AND x.datato AND x.isdelete = FALSE LIMIT 1) ELSE a.invoicexrate END) AS invoicexrate
				,(CASE WHEN a.invoiceid IS NULL THEN (SELECT x.xtype FROM _inv_exchangerate x WHERE x.currencyfm = a.currency AND x.currencyto = $cyto$ AND a.jobdate BETWEEN x.datafm AND x.datato AND x.isdelete = FALSE LIMIT 1) ELSE a.invoicextype END) AS invoicextype
				,(CASE WHEN a.invoiceid IS NULL THEN f_amtto_inv(a.jobdate::DATE , a.currency , $cyto$ , (CASE WHEN a.araptype = 'AR' THEN amount ELSE -amount END))::NUMERIC(18,2) ELSE a.invoiceamountflag::NUMERIC(18,2) END) AS invoiceamountflag

				,(SELECT string_agg(COALESCE(x.sono,''),',') FROM bus_shipping x WHERE x.isdelete = FALSE AND x.jobid = a.jobid AND x.sono IS NOT NULL AND x.sono &lt;&gt; '') AS sono
				,a.remarks
				,(SELECT COALESCE(x.abbcode,'') FROM sys_corporation x WHERE x.id = a.corpid) AS corper
				,(SELECT payplace FROM fina_arap WHERE isdelete = FALSE AND id = a.id) AS payplace
				,a.amtstl2
				,(select (regexp_split_to_array(string_agg(r.accountcont,','), E'\\n+'))[1] from fina_rpreq r ,fina_rpreqdtl d  where r.id = d.rpreqid  AND d.isdelete = FALSE AND d.arapid = a.id) AS account
				,(1-a.taxrate) as taxrate2
			FROM _fina_arap AS a
			WHERE $qry$
				AND $jobs$
				AND a.isdelete = FALSE
				$clause$
				$arapfilter$
				$sonoFilter$
				$selectedIdsStr$
				$currencyparame$
				$taxrateparame$
		) SELECT * FROM rc_arap t
		WHERE TRUE
			$accountfilter$
			$onlyShowwriteoff$
		ORDER BY invoiceid,araptype DESC,jobdate,arapdate
	</select>
	<select id="pages.module.ship.businvoiceBean.grid.count"
		parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT
			COUNT(*) AS counts
		FROM(
		WITH rc_arap AS(
		SELECT
				a.feeitemid
				,a.araptype
				,a.amount
				,a.customerid
				,a.isamend
			FROM _fina_arap AS a
			WHERE $qry$
			AND $jobs$
			AND a.isdelete = FALSE
			$clause$
			$arapfilter$
			$sonoFilter$
			$selectedIdsStr$
			$currencyparame$
			$taxrateparame$
		) SELECT * FROM rc_arap t
		WHERE TRUE
			$accountfilter$
		) q
	</select>

	<select id="pages.module.ship.busbillBean.grid.page"
		parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT row_number() OVER() AS row,* FROM(
		SELECT
			 a.id
			, a.ordno
			,(CASE WHEN a.billid is not null then true else false end) AS ischoose
			,a.araptype
			,a.ppcc
			,a.arapdate
			,a.feeitemdec
			,a.customecode
			,a.currency
			,a.billid
			,a.billxrate
			,a.billxtype
			,a.jobno
			,a.jobdate
			,(SELECT x.atd FROM bus_shipping x WHERE x.isdelete = FALSE AND x.jobid = a.jobid) AS atd
			,a.remarks
			,a.amtstl2
			,a.inputtime
			,(SELECT COALESCE(x.abbr,'') FROM sys_corporation x WHERE id = a.customerid AND isdelete = FALSE) AS customeabbr
			,((a.amount+COALESCE(t.amount,0))) AS amount
			,((a.billamountflag+COALESCE(t.billamountflag,0))) AS billamountflag
		FROM _fina_arap AS a LEFT JOIN _fina_arap t ON (t.parentid = a.id AND t.isdelete = FALSE)
		WHERE $qry$
			AND $jobs$
			AND a.isdelete = FALSE
			$clause$
		ORDER BY $orderSql$ ordno,jobno,a.araptype DESC,a.ppcc,a.customecode,a.currency DESC , a.feeitemdec) AS T

	</select>
	<select id="pages.module.ship.busbillBean.grid.count"
		parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT
			COUNT(*) AS counts
		FROM _fina_arap AS a
		WHERE $qry$
			AND $jobs$
			AND a.isdelete = FALSE
			$clause$
	</select>

	<!--BMS账单页面-->
	<select id="pages.module.ship.bmsbillBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT row_number() OVER() AS row,* FROM(
		SELECT
			 a.id
			, a.ordno
			,(CASE WHEN a.billid is not null then true else false end) AS ischoose
			,a.araptype
			,a.ppcc
			,a.arapdate
			,a.feeitemdec
			,a.customecode
			,a.currency
			,a.amount
			,a.billid
			,a.billxrate
			,a.billxtype
			,a.billamountflag
			,a.jobno
			,a.jobdate
			,(SELECT x.atd FROM bus_shipping x WHERE x.isdelete = FALSE AND x.jobid = a.jobid) AS atd
			,a.remarks
			,a.amtstl2
			,a.inputtime
			,(SELECT COALESCE(x.abbr,'') FROM sys_corporation x WHERE id = a.customerid AND isdelete = FALSE) AS customeabbr
		FROM _fina_arap AS a
		WHERE $qry$
			AND $jobs$
			AND a.isdelete = FALSE
			$clause$
		ORDER BY $orderSql$ ordno,jobno,a.araptype DESC,a.ppcc,a.customecode,a.currency DESC , a.feeitemdec) AS T
	</select>
	<select id="pages.module.ship.bmsbillBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT
			COUNT(*) AS counts
		FROM _fina_arap AS a
		WHERE $qry$
			AND $jobs$
			AND a.isdelete = FALSE
			$clause$
	</select>

	<select id="pages.module.ship.jobseditBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
	<![CDATA[
		SELECT DISTINCT	t.id,prefix,code ,r.datefm , t.namec
			FROM sys_busnodesc t ,sys_busnorule r
			WHERE $qry$
			AND t.id = r.busnotypeid
			AND code like 'fina_jobs%'
			AND t.isdelete = FALSE AND r.isdelete = FALSE
			AND code NOT LIKE 'fina_jobs_air%'
			AND code NOT LIKE 'fina_jobs_lan%'
			AND code NOT LIKE 'fina_jobs_train%'
			AND code NOT LIKE 'fina_jobs_customs%'
			AND code NOT LIKE 'fina_jobs_fee%'

		order by t.namec,r.datefm, prefix
	]]>
	</select>
	<select id="pages.module.ship.jobseditBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 10000 AS counts
	</select>

	<select id="pages.module.ship.busbillcntsBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT *
		FROM _bus_ship_container c
		WHERE $qry$
		AND isdelete = FALSE
		AND parentid IS NULL
		AND jobid = $jobid$
		order by orderno
	</select>
	<select id="pages.module.ship.busbillcntsBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT
		 count(*) AS counts
		FROM _bus_ship_container c
		WHERE $qry$
		AND isdelete = FALSE
		AND parentid IS NULL
		AND jobid = $jobid$
	</select>

	<select id="pages.module.ship.containerdetailBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 t.*
		 ,COALESCE(piece * price , 0) AS amt
		FROM bus_packlist t
		WHERE $qry$
	   ORDER BY t.id
	</select>
	<select id="pages.module.ship.containerdetailBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(1) AS counts
		FROM bus_packlist t
		WHERE $qry$
	</select>

	<select id="pages.module.ship.dangersdetailBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 t.*
		FROM bus_packlist t
		WHERE $qry$
	</select>
	<select id="pages.module.ship.dangersdetailBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(1) AS counts
		FROM bus_packlist t
		WHERE $qry$
	</select>
	<select id="pages.module.ship.jobseditBean.gridCustomer.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
			*
		FROM _sys_corporation t
		WHERE $qry$
		  AND isdelete = FALSE
		  AND isar = TRUE
		  AND isap = TRUE
		ORDER BY code
		LIMIT 100 OFFSET 0
	</select>
	<select id="pages.module.ship.jobseditBean.gridCustomer.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
			count(*) AS counts
		FROM _sys_corporation t
		WHERE $qry$
		  AND isdelete = FALSE
		  AND isar = true
		  AND isap = true
	</select>

	<select id="pages.module.ship.jobseditBean.gridUser.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM _sys_user t
		WHERE $qry$
			AND isdelete = FALSE
			AND isinvalid = TRUE
			AND iscsuser = FALSE
		ORDER BY company,depter2,code
	</select>
	<select id="pages.module.ship.jobseditBean.gridUser.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM _sys_user t
		WHERE $qry$
			AND isdelete = FALSE
			AND isinvalid = TRUE
			AND iscsuser = FALSE
	</select>
	<select id="pages.module.ship.billistelrelBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		 <![CDATA[
		select
		 t.*
		 ,(SELECT hblno FROM bus_shipping WHERE isdelete = false and id = t.shipid) AS hblnos
		 ,(SELECT hbltype FROM bus_shipping WHERE isdelete = false and id = t.shipid) AS hbltype
		 ,(SELECT mbltype FROM bus_shipping WHERE isdelete = false and id = t.shipid) AS mbltype
		 ,(SELECT substring(b.cnortitle FROM 1 FOR (CASE WHEN position(CHR(10) in b.cnortitle)< 1  THEN length(b.cnortitle) ELSE (position(CHR(10) in b.cnortitle)-1) END)) FROM bus_shipping b WHERE b.isdelete = FALSE AND b.id = t.shipid) AS cnortitle
		 ,(SELECT namec||'/'||namee||'/'||COALESCE((SELECT name FROM sys_department WHERE id = x.deptid),'') FROM sys_user x WHERE id = t.saleid) AS saleuser
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.inputer and x.isdelete = false limit 1),t.inputer) AS inputername
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.updater and x.isdelete = false limit 1),t.updater) AS updatername
		 ,(SELECT idcode FROM sys_user x WHERE id = t.saleid) AS idcode
		 ,(SELECT (CASE WHEN s.namec = '' OR s.namec IS NULL THEN s.namee ELSE s.namec END) FROM sys_corporation s, fina_jobs j where j.id = t.jobpkid and j.customerid = s.id) AS customabbr
		 ,(SELECT isgetmbl FROM bus_shipping WHERE isdelete = false and id = t.shipid) AS isgetmbl2
		FROM f_rpa_fina_jobs_paycheck('userid=$userid$;srctype=TELEX;$args$') t
		WHERE $qry$
			$filter$
			$dynamicClauseWhere$
			AND jobtype = 'S'
			LIMIT $limit$ OFFSET $start$
		 ]]>
	</select>
	<select id="pages.module.ship.billistelrelBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(1) AS counts
		FROM f_rpa_fina_jobs_paycheck('userid=$userid$;srctype=TELEX;$args$') t
		WHERE $qry$
			$filter$
			AND jobtype = 'S'
			$dynamicClauseWhere$
	</select>

	<select id="pages.module.ship.busfreightchargeBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM bus_freightcharge t
		WHERE $qry$
			AND jobid = $jobid$
		ORDER BY freightcharge
	</select>
	<select id="pages.module.ship.busfreightchargeBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM bus_freightcharge t
		WHERE $qry$
			AND jobid = $jobid$
	</select>
	<select id="pages.module.ship.syssnapshotsBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		FROM sys_snapshots t
		WHERE $qry$
		 ORDER BY inputtime desc
	</select>
	<select id="pages.module.ship.syssnapshotsBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM sys_snapshots t
		WHERE $qry$
	</select>

	<select id="pages.module.ship.mgrtrainbookingBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		 ,(SELECT namee FROM dat_port p WHERE p.id = t.polid and p.ispol = true and p.isdelete = false limit 1) AS pol
		 ,(SELECT namee FROM dat_port p WHERE p.id = t.podid and p.ispod = true and p.isdelete = false limit 1) AS pod
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.inputer and x.isdelete = false limit 1),t.inputer) AS inputername
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.updater and x.isdelete = false limit 1),t.updater) AS updatername
		FROM bus_booking_train t
		WHERE $qry$
		and t.isdelete = false
		 ORDER BY inputtime desc
	</select>
	<select id="pages.module.ship.mgrtrainbookingBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM bus_booking_train t
		WHERE $qry$
		and t.isdelete = false
	</select>

	<select id="pages.module.ship.qrytrainbookingBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		 ,(SELECT namee FROM dat_port p WHERE p.id = t.polid and p.ispol = true and p.isdelete = false limit 1) AS pol
		 ,(SELECT namee FROM dat_port p WHERE p.id = t.podid and p.ispod = true and p.isdelete = false limit 1) AS pod
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.inputer and x.isdelete = false limit 1),t.inputer) AS inputername
		 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.updater and x.isdelete = false limit 1),t.updater) AS updatername
		 ,(t.cbmtotle - COALESCE((select sum(d.cbmtotle) FROM wms_indtl d, wms_in s WHERE d.inid = s.id AND t.traindate = s.traindate AND (SELECT namee FROM dat_port p WHERE p.id = t.polid and p.ispol = true and p.isdelete = false limit 1) = s.pol AND (SELECT namee FROM dat_port p WHERE p.id = t.podid and p.ispod = true and p.isdelete = false limit 1)=s.pod AND s.isubmit = true),0)) AS cbm
		 ,(t.wgttotle - COALESCE((select sum(d.wgttotle) FROM wms_indtl d, wms_in s WHERE d.inid = s.id AND t.traindate = s.traindate AND (SELECT namee FROM dat_port p WHERE p.id = t.polid and p.ispol = true and p.isdelete = false limit 1) = s.pol AND (SELECT namee FROM dat_port p WHERE p.id = t.podid and p.ispod = true and p.isdelete = false limit 1)=s.pod AND s.isubmit = true),0)) AS wgt
		 ,(t.piecehq - (COALESCE((SELECT count(s.ldtype) FROM bus_ship_container s , bus_train b, dat_cntype p WHERE s.jobid = b.jobid AND s.ldtype = 'F' AND s.isdelete = FALSE AND t.traindate = b.etd AND t.polid = b.polid AND t.podid=b.podid AND s.cntypeid = p.id AND p.code LIKE '%40%' AND p.code LIKE '%HQ%'),0))) AS hq
		FROM bus_booking_train t
		WHERE $qry$
		and t.isdelete = false
		 ORDER BY inputtime desc
	</select>
	<select id="pages.module.ship.qrytrainbookingBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 count(*) AS counts
		FROM bus_booking_train t
		WHERE $qry$
		and t.isdelete = false
	</select>


	<select id="pages.module.ship.unioneditBean.nosgrid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
	<![CDATA[
		SELECT DISTINCT	t.id,prefix,code ,r.datefm , t.namec
			FROM sys_busnodesc t ,sys_busnorule r
			WHERE $qry$
			AND t.id = r.busnotypeid
			AND code like 'bus_shipjoin%'
			AND t.isdelete = FALSE AND r.isdelete = FALSE
			AND now() BETWEEN r.datefm AND (r.dateto::timestamp  + '3 month')
		order by t.namec,r.datefm, prefix
	]]>
	</select>
	<select id="pages.module.ship.unioneditBean.nosgrid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 10000 AS counts
	</select>


	<select id="pages.module.ship.jobseditBean.gridCntTracksgrid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
	<![CDATA[
		SELECT
			bsct.id
		 	,bsbc.cntno
		 	,bsct.sts1code
		 	,bsct.statuse
		 	,bsct.locatione
		 	,bsct.dealdate
		 	,(select vessel from bus_shipping where isdelete = false and jobid = bsc.jobid limit 1) as vessel
		 	,(select voyage from bus_shipping where isdelete = false and jobid = bsc.jobid limit 1) as voyage
		FROM bus_ship_booking bsb
		LEFT JOIN bus_ship_book_cnt bsbc ON bsb.ID = bsbc.linkid
		LEFT JOIN bus_ship_container_track bsct ON bsbc.ID = bsct.linkid
		inner join bus_ship_container bsc on bsc.isdelete = false and bsc.parentid is null
			and coalesce(bsc.cntno,'') !='' and bsc.jobid= $jobid$ and bsb.sono = bsc.sono and bsbc.cntno = bsc.cntno
		WHERE 1=1
		and bsct.ID IS NOT NULL
		$filter$
		LIMIT 30 OFFSET 0
	]]>
	</select>
	<select id="pages.module.ship.jobseditBean.gridCntTracksgrid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 10000 AS counts
	</select>


	<select id="pages.module.ship.voyageBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		 *
		 ,(select sc.code from sys_corporation sc where sc.id ::text = bsbv.carrierid limit 1) as carriercode
		 ,(select df.namec from dat_filedata df WHERE df.isleaf = TRUE AND df.isdelete = false AND df.fkcode = 350 and df.code  = bsbv.transportmode limit 1) as transportmodenamec
		 ,(select df.namec from dat_filedata df WHERE df.isleaf = TRUE AND df.isdelete = false AND df.fkcode = 360 and df.code  = bsbv.transporttype limit 1) as transporttypenamec
		FROM bus_ship_book_vesvoy bsbv
		WHERE
			$qry$
			$filter$
		ORDER BY coalesce(voyagenumber,0),id
		LIMIT $limit$ OFFSET $start$
	</select>
	<select id="pages.module.ship.voyageBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
		  count(1) as counts
		FROM bus_ship_book_vesvoy t
		WHERE
			$qry$
			$filter$
	</select>
</sqlMap>
