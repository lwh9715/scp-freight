<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap>	
	<select id="pages.sysmgr.knowledge.knowledgeBaseBean.grid.page" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT * FROM 
			(select 
				 * 
				 ,(f_common_get_table_value('colum=namec;tabname='||COALESCE(t.linktbl,'')||';id='||t.linkid)) AS linknamec
				 ,(CASE libtype WHEN 'A' THEN '委托人' WHEN 'B' THEN '订舱代理' WHEN 'C' THEN '船公司' WHEN 'D' THEN '航线' WHEN 'E' THEN '港口' WHEN 'F' THEN '航空公司' WHEN 'G' THEN '报关行' WHEN 'H' THEN '车行' WHEN 'I' THEN '目的港代理' END) AS linktblc
				 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.inputer and x.isdelete = false limit 1),t.inputer) AS inputername
				 ,COALESCE((SELECT x.namec FROM sys_user x where x.code = t.updater and x.isdelete = false limit 1),t.updater) AS updatername
				FROM sys_knowledgelib t
			) AS T
			WHERE $qry$
					AND isdelete = FALSE
		ORDER BY libtype , linknamec
		LIMIT $limit$ OFFSET $start$;
	</select>
	<select id="pages.sysmgr.knowledge.knowledgeBaseBean.grid.count" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT count(1) AS counts  FROM 
			(select 
			 	* 
				,(f_common_get_table_value('colum=namec;tabname='||COALESCE(t.linktbl,'')||';id='||t.linkid)) AS linknamec
			FROM sys_knowledgelib t 
			) AS T
			WHERE $qry$
				AND isdelete = FALSE
	</select>
</sqlMap>
