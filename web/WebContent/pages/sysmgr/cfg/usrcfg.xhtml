<?xml version="1.0" encoding="UTF-8"?>
<f:view xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:w="http://www.apusic.com/jsf/widget" xmlns:layout="http://www.apusic.com/jsf/layout"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:ajax="http://www.apusic.com/jsf/ajax" xmlns:om="http://www.apusic.com/jsf/misc"
	renderKitId="AJAX">
	<w:head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /> 
		<link rel="shortcut icon" href="#{constantBean.contextPath}/favicon.ico" />
		<link rel="icon" type="image/gif" href="#{constantBean.contextPath}/favicon.ico" />
		<w:stylesheet src="/common/css/common.css"></w:stylesheet>
		<link rel="stylesheet" id="cmsbg" type="text/css"/>
		<w:script src="/common/js/common.js?t=4"></w:script>
		
		<script src="http://apps.bdimg.com/libs/jquery/1.11.3/jquery.min.js"></script>
		<link rel="stylesheet" type="text/css" href="/scp/common/css/jquery.flexbox.css" />
		<script type="text/javascript" src="/scp/common/js/jquery.flexbox.js"></script>
		
		<w:script type="text/javascript" src="/common/ckeditor/ckeditor.js"></w:script>
		<w:script type="text/javascript" src="/common/ckeditor/extckeditor.js"></w:script>
	
		<script type="text/javascript" src="/scp/_global/resource/ext/src/locale/ext-lang.js?#{commonBean.lang}"></script>
		<script type="text/javascript" src="/scp/_global/resource/om/locale/om-lang.js?#{commonBean.lang}"></script>
		<!--二维码 -->
		<script src="/scp/common/js/qrcode.js"></script>
	</w:head>
	<w:page loadMask="true" loadMaskText="Loading..." title="">
		<ajax:conversationActivator/>
		<layout:tabLayout fit="true">

			<layout:panel id="usercfgpanel" title="#{l.m['个人设置']}">
				<w:form id="usercfg">
					<w:toolBar>
						<w:button id="saveUserCfgBut" value="#{l.m['保存']}" onclick="setBgColor()"
								  image="#{constantBean.contextPath}/images/save.png"/>
						<w:button id="cfgSignature" jsvar="cfgSignature" value="#{l.m['设置签名']}"
								  image="#{constantBean.contextPath}/images/save.png"/>
					</w:toolBar>
					<layout:panelGrid columns="8">
						<layout:panelGrid columns="6" cellspacing="5px" style="font-size:12px">
							<layout:cell colspan="2" style="width: 265px; border: solid #ABCDEF 1px;">
								<layout:panelGrid columns="2">
									<h:outputLabel value="#{l.m['背景色']}"></h:outputLabel>
									<w:combo forceSelection="true" width="100" jsvar="bgColorJsVar"
											 value="#{pages.sysmgr.cfg.usrcfgBean.cfgDataMap['bg_color']}">
										<f:selectItem itemValue="blue" itemLabel="商务蓝"/>
										<f:selectItem itemValue="green" itemLabel="护眼绿"/>
										<f:selectItem itemValue="pink" itemLabel="粉红色"/>
									</w:combo>
									<h:outputLabel value="#{l.m['时区']}"></h:outputLabel>
									<w:combo forceSelection="true" width="100"
											 value="#{pages.sysmgr.cfg.usrcfgBean.cfgDataMap['timestamp_with_time_zone']}">
										<f:selectItems value="#{comboxBean.timezone}"/>
									</w:combo>
								</layout:panelGrid>
							</layout:cell>
						</layout:panelGrid>
					</layout:panelGrid>

					<ajax:status startStyle="color: red"
								 onstart="document.getElementsByTagName('body').item(0).style.cursor='progress'"
								 onstop="document.getElementsByTagName('body').item(0).style.cursor='auto'">
						<f:facet name="start">
							<f:verbatim>
								<img src="#{constantBean.contextPath}/images/waiting.gif"/>
							</f:verbatim>
						</f:facet>
					</ajax:status>

					<ajax:submitAction id="saveAction" jsvar="saveAction"/>
					<w:textField selectOnFocus="true" id="userid" jsvar="userid" hidden="true"/>
				</w:form>
				<div id="myImg"></div>
			</layout:panel>

			<layout:panel title="API">
				<w:form>
					<w:toolBar>
						<w:button id="saveApi" value="#{l.m['保存']}"
								  image="#{constantBean.contextPath}/images/save.png"/>
					</w:toolBar>
					<layout:panelGrid columns="2" cellspacing="5px" width="500" style="font-size:12px">
						<h:outputLabel value="OOCL_APIKey"/>
						<w:textField selectOnFocus="true" width="300" id="oocl_apikey" inputType="password"
									 value="#{pages.sysmgr.cfg.usrcfgBean.cfgDataMap['oocl_apikey']}"></w:textField>
						<h:outputLabel value="OOCL_COME_NAME"/>
						<w:textField selectOnFocus="true" width="300" id="oocl_come_name"
									 value="#{pages.sysmgr.cfg.usrcfgBean.cfgDataMap['oocl_come_name']}"></w:textField>
						<h:outputLabel value="OOCL_COME_ADDR1"/>
						<w:textField selectOnFocus="true" width="300" id="oocl_come_addr1"
									 value="#{pages.sysmgr.cfg.usrcfgBean.cfgDataMap['oocl_come_addr1']}"></w:textField>
						<h:outputLabel value="OOCL_COME_ADDR2"/>
						<w:textField selectOnFocus="true" width="300" id="oocl_come_addr2"
									 value="#{pages.sysmgr.cfg.usrcfgBean.cfgDataMap['oocl_come_addr2']}"></w:textField>
					</layout:panelGrid>
					<ajax:status startStyle="color: red"
								 onstart="document.getElementsByTagName('body').item(0).style.cursor='progress'"
								 onstop="document.getElementsByTagName('body').item(0).style.cursor='auto'">
						<f:facet name="start">
							<f:verbatim>
								<img src="#{constantBean.contextPath}/images/waiting.gif"/>
							</f:verbatim>
						</f:facet>
					</ajax:status>
				</w:form>
			</layout:panel>
		</layout:tabLayout>

		<layout:window maximizable="true" title="#{l.m['设置签名']}" id="showSignWindow" jsvar="showSignWindow" width="600" height="530"
					   header="false" resizable="true" constrainHeader="true">
			<w:iframe style="width: 100%; height: 100%;" frameborder="no" id="signIframe"
					  name="signIframe"/>
		</layout:window>

		<layout:window maximizable="true" title="#{l.m['邮箱签名']}" id="showEmailSignWindow" jsvar="showEmailSignWindow" width="600" height="530"
					   header="false" resizable="true" constrainHeader="true">
			<layout:panel id="editPanel" jsvar="gridPanelJsvar" height="100%" hideBorders="true"
						  fit="true">
				<w:form id="formedt">
					<layout:panelGrid columns="2">
						<w:toolBar>
							<w:button id="saveEmailSign" value="#{l.m['保存']}" allowReEnter="false" onclick="beforeSubmit()"
									  image="#{constantBean.contextPath}/images/save.png"/>
						</w:toolBar>
					</layout:panelGrid>
					<layout:panelGrid width="600" columns="2" style="font-size:12px">
						<f:verbatim></f:verbatim>
						<layout:cell colspan="2" styleClass="td-editor" style="width:600px; height:100%;">
							<h:outputText id="ckeditor" escape="false" style="width: 100%;height: 100%;"
										  value="#{pages.sysmgr.cfg.usrcfgBean.cfgDataMap['email_sign']}"/>
						</layout:cell>
					</layout:panelGrid>
				</w:form>
			</layout:panel>
		</layout:window>

		<layout:window maximizable="true" id="logoWindow" jsvar="logoWindowJsVar" width="400" height="150" title="#{l.m['上传']}LOGO">
			<w:form>
				<layout:panelGrid columns="2" cellspacing="5px" width="500" style="font-size:12px">
					<layout:cell colspan="2">
						<layout:panelGrid columns="6" width="450" style="font-size:12px">
							<h:outputLabel value="LOGO"/>
							<w:fileUpload id="fileUpload1" uploadListener="#{pages.sysmgr.cfg.usrcfgBean.processUpload1}"
										  rich="true" maxSize="3000k"/>
						</layout:panelGrid>
					</layout:cell>

					<layout:cell colspan="2">
						<layout:panelGrid columns="6" width="450" style="font-size:12px">
							<w:button label="#{l.m['上传']}"></w:button>
							<w:fileUploadProgress startMessage="#{l.m['开始上传']}" id=""
												  uploadingMessage="#{l.m['正在上传，已经上传']}{readBytes}k/{total}k({percentage}%)"
												  completeMessage="#{l.m['上传结束，总共']}{total}k" errorMessage="#{l.m['上传错误：']}{error}"/>
						</layout:panelGrid>
					</layout:cell>
				</layout:panelGrid>
			</w:form>
		</layout:window>


		<layout:window maximizable="true" width="510" height="530" id="userWindow" jsvar="userWindowJs" y="10"
					   constrainHeader="true">
			<layout:panel id="userPanel" height="100%" hideBorders="true" width="100%" fit="true">
				<w:form>
					<layout:panelGrid columns="10" cellspacing="0" cellpadding="0">
						<w:textField id="qryuserdesc" selectOnFocus="true" width="200" emptyText="#{l.m['代码/中文名/英文名/分公司/部门']}"/>
						<w:button id="qryuser" value="#{l.m['查询']}"
								  image="#{constantBean.contextPath}/images/query-small.png"/>
						<w:button id="confirm" value="#{l.m['确认']}" jsvar="confirmJsVar"
								  image="#{constantBean.contextPath}/images/save.png"/>
						<w:button value="#{l.m['确认并关闭']}" allowReEnter="true" onclick='confirmJsVar.fireEvent("click");userWindowJs.hide()'
								  image="#{constantBean.contextPath}/images/save.png"/>
						<w:button id="empty" value="#{l.m['清空']}"
								  image="#{constantBean.contextPath}/images/save.png"/>
					</layout:panelGrid>
					<w:dataGrid height="475" jsvar="gridUserJsvar" paged="true" rows="200" id="gridUser"
								selectionModel="#{constantBean.checkBox}" toolBarPosition="bottom" idColumn="id"
								selectable="true">
						<w:outputColumn id="id" header="ID" hidden="true"/>
						<w:outputColumn header="#{l.m['代码']}" id="code" sortable="true" width="80"/>
						<w:outputColumn header="#{l.m['中文名']}" id="namec" width="80" sortable="true"/>
						<w:outputColumn header="#{l.m['英文名']}" id="namee" width="80" sortable="true"/>
						<w:outputColumn header="#{l.m['部门']}" id="depter2" width="80" sortable="true"/>
						<w:outputColumn header="#{l.m['分公司']}" id="company" width="120" sortable="true"/>
					</w:dataGrid>
					<w:pagingToolbar for="gridUser" target="gridUser" displayInfo="true"
									 displayMsg="{0}-{1}/{2}">
					</w:pagingToolbar>
				</w:form>
			</layout:panel>
		</layout:window>


		<layout:window maximizable="true" title="#{l.m['']}" id="portnoticeWindow" jsvar="portnoticeWindowJs" width="400" height="230"
					   header="false" resizable="true" constrainHeader="true">
			<layout:panel id="editPanel2" jsvar="gridPanelJsvar" height="100%" hideBorders="true"
						  fit="true">
				<w:form id="formedt2">
					<layout:panelGrid columns="2">
						<w:toolBar>
							<w:button id="saveUserCfgBut2" value="#{l.m['保存']}" allowReEnter="false"
									  image="#{constantBean.contextPath}/images/save.png"/>
						</w:toolBar>
					</layout:panelGrid>
					<layout:panelGrid columns="6" cellspacing="0" cellpadding="0">
						<layout:panelGrid columns="6" cellpadding="0" cellspacing="0">
							<h:outputLabel value="#{l.m['提空箱']}"/>
							<w:checkBox value="#{pages.sysmgr.cfg.usrcfgBean.cfgDataMap['subscribe_msg_portnotice_STSP']}"></w:checkBox>

							<h:outputLabel value="#{l.m['码头放行']}"/>
							<w:checkBox value="#{pages.sysmgr.cfg.usrcfgBean.cfgDataMap['subscribe_msg_portnotice_TMPS']}"></w:checkBox>

							<h:outputLabel value="#{l.m['卸船']}"/>
							<w:checkBox value="#{pages.sysmgr.cfg.usrcfgBean.cfgDataMap['subscribe_msg_portnotice_DSCH']}"></w:checkBox>

							<h:outputLabel value="#{l.m['进港']}"/>
							<w:checkBox value="#{pages.sysmgr.cfg.usrcfgBean.cfgDataMap['subscribe_msg_portnotice_GITM']}"></w:checkBox>

							<h:outputLabel value="#{l.m['配载']}"/>
							<w:checkBox value="#{pages.sysmgr.cfg.usrcfgBean.cfgDataMap['subscribe_msg_portnotice_PRLD']}"></w:checkBox>

							<h:outputLabel value="#{l.m['提货']}"/>
							<w:checkBox value="#{pages.sysmgr.cfg.usrcfgBean.cfgDataMap['subscribe_msg_portnotice_PCAB']}"></w:checkBox>

							<h:outputLabel value="#{l.m['海关放行']}"/>
							<w:checkBox value="#{pages.sysmgr.cfg.usrcfgBean.cfgDataMap['subscribe_msg_portnotice_PASS']}"></w:checkBox>

							<h:outputLabel value="#{l.m['上船']}"/>
							<w:checkBox value="#{pages.sysmgr.cfg.usrcfgBean.cfgDataMap['subscribe_msg_portnotice_LOBD']}"></w:checkBox>

							<h:outputLabel value="#{l.m['还空箱']}"/>
							<w:checkBox value="#{pages.sysmgr.cfg.usrcfgBean.cfgDataMap['subscribe_msg_portnotice_RCVE']}"></w:checkBox>
						</layout:panelGrid>
					</layout:panelGrid>
				</w:form>
			</layout:panel>
		</layout:window>

	</w:page>

<script>
	//<![CDATA[
	
	var qrcode = new QRCode(document.getElementById("qrcode"), {
       	width : 250,//设置宽高
       	height : 250
    });
	
	function resize(){
		var newHeight = (gridPanelJsvar.getSize().height) - 35;
		var newWidth = (gridPanelJsvar.getSize().width);
		gridJsvar.setHeight(newHeight);
		gridJsvar.setWidth(newWidth);
		gridJsvar.render();
	}
	
	Ext.onReady(function(){
		Ext.EventManager.onWindowResize(function(){
		});
		$.ajax({
				type:'POST',
				dataType: 'html',
				url:'/scp/service?src=webServer&action=getFile&userid='+userid.getValue(),
				success:function(date){
					if(date.toString().indexOf("ERROR") == 0){
						return;
					}
					var img = $('<img>').attr('src', date);
		            $(myImg).append($('<p>').text("Signature:"));
		            $(myImg).append(img);
				}
         });
         	$('#sales_input').bind("input propertychange", function(){
			  	if($('#sales_input').val()==''){//监听当改变值为空时候清掉saleid的值
			  		saleidJsVar.setValue('');
			  	}
			});
		editor1 = Ext.form.CKEditor.create("formedt:ckeditor");
		
		refreshQrCode();
		$("#usercfg\\:user").dblclick( function () { userWindowJs.show(); });
	 });
	 
	  function refreshQrCode(){
	  	// var utl = window.location.protocol + "//" + window.location.host;
		//var urlQrCode = utl + '#{constantBean.contextPath}' + '/reportJsp/businesscardupload.jsp?userid='+userIdJsvar.getValue();
		var url = codeUrlJsVar.getValue();
		qrcode.makeCode(url);
	  }
	 
	  function setValue(text) {
        	editor1.setValue(text);
      }
      
      function beforeSubmit() {
       	saveAction.addParam('editor1',editor1.getValue());
       	saveAction.submit();
	  }
	    
	    setInterval('timeraction.submit();',5000);//监控opneid是否被赋值
	    setInterval('setopenid()',1000)
	    
		function setopenid(){
			if(ispenid.getValue() == true){
				$('#qrcode').hide();
			}else{
				$('#qrcode').show();
			}
		}
		
		function setuserid(){
			useridJsVar.setValue(saleidJsVar.getValue());
		}
		
		function setBgColor(){
			var bgcolor = bgColorJsVar.getValue();
			window.localStorage.bgcolor = bgcolor
			setUserBgColor();
		}
	 
	 //]]>
</script>

</f:view>