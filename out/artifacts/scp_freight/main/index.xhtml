<?xml version="1.0" encoding="UTF-8"?>
<f:view xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:w="http://www.apusic.com/jsf/widget" xmlns:layout="http://www.apusic.com/jsf/layout"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:ajax="http://www.apusic.com/jsf/ajax"
	xmlns:ui="http://java.sun.com/jsf/facelets" renderKitId="AJAX">
	<w:head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /> 
		<link rel="shortcut icon" href="#{constantBean.contextPath}/favicon.ico" />
		<link rel="icon" type="image/gif" href="#{constantBean.contextPath}/favicon.ico" />
		<w:stylesheet src="/common/css/common.css"></w:stylesheet>
		<link rel="stylesheet" id="cmsbg" type="text/css"/>
		<w:script src="/common/js/common.js?t=4"></w:script>
		<script type="text/javascript" src="/scp/common/js/check.js?t=1"></script>
		<script src="#{constantBean.contextPath}/common/js/jquery-2.0.0.min.js" type="text/javascript"></script>
		
		<w:stylesheet src="/pages/module/common/css/tabPanelIcon.css" />
		<w:stylesheet src="./base_color.css" />
		<w:stylesheet src="./base.css" />
		
		<script>
        //<![CDATA[
            function openNavTree(obj , index){
            	openNavTreeAjax.addParam('index',index);
            	openNavTreeAjax.submit();
            }
        //]]>
        </script>
	</w:head>

	<w:page loadMask="true" loadMaskText="......" title="#{constantBean.headTitle}" >
		<ajax:conversationActivator/>
		<layout:borderLayout fit="true" fitToBody="true" id="border" border="false" hideBorders="true"
			style="border: thin">
			
			<layout:panel region="north" height="48" title="">
				<ui:include src="./header.xhtml" />
				<w:form>
					<div>
						<w:textField hidden="true" id="windowStatus" jsvar="windowStatusJs" ></w:textField>
						<w:textField hidden="true" id="bgcolor" jsvar="bgcolorJsVar" ></w:textField>
					</div>
				</w:form>
			</layout:panel>
			
			<layout:panel region="west" width="186" height="100%" border="false" hideBorders="true" 
				style="border: thin" id="navPanel" jsvar="navPanelJsvar" title="#{main.indexBean.userInfo}" split="true" fit="true"
				collapsible="true">
				<w:tree id="navTree" autoLeaf="true" expandAll="false" autoScroll="true" border="false" jsvar="navTreeJsVar"
					style="height:100%;width:100%;border-color: blue" rootVisible="false" loadAllNodes="true"/>
			</layout:panel>

			<layout:panel region="center" border="false" hideBorders="true" style="border: thin"
				split="true" >
				<layout:tabLayout id="centerPanel" border="false" hideBorders="true"
					tabPosition="top" style="border: thin;border-color: blue;" />
			</layout:panel>
		</layout:borderLayout>
	<layout:window id="showWindow" width="220" height="380" constrainHeader="true" resizable="true">
		<w:iframe style="width: 100%; height: 100%;" frameborder="no" id="dtlIFrame" name="dtlIFrame" />
	</layout:window>
	
	<layout:window id="getNoticeWindow" width="881" height="621" constrainHeader="true" resizable="true" border="false"
		onactivate="$('#activemqImg').removeClass('className')" onclose="getNoticeWindowclose.submit();">
		<w:iframe style="width: 100%; height: 100%;" frameborder="no" id="getNoticeIFrame" name="getNoticeIFrame"/>
	</layout:window>
	
	<layout:window id="userInfoWindow" jsvar="userInfoWindowJsVar" width="900" height="600" maximizable="true" constrainHeader="true" resizable="true">
		<w:iframe style="width: 100%; height: 100%;" frameborder="no" id="userInfoIFrame" name="userInfoIFrame" />
	</layout:window>

</w:page>
	
	<ajax:submitAction id="openNavTreeAjax" jsvar="openNavTreeAjax" />
	<ajax:submitAction id="changeTipStatus" jsvar="changeTipStatus" />
	<ajax:submitAction id="getNoticeWindowclose" jsvar="getNoticeWindowclose" />
	
	<script>
	 //<![CDATA[
	 	
	 	var treemoduleid ;
	 	var itemsvalue = [{
            id:'rMenu1',
            icon:'#{constantBean.contextPath}/images/logs.png',
            text : '无',
            //增加菜单点击事件
            handler:function (node){
              //alert(node.value);
            }
        }];
        
        function showUserInfo(){
        	userInfoWindowJsVar.show();
        	var url = "/scp/pages/sysmgr/user/userinfomgr.xhtml";
        	$("#userInfoIFrame").attr("src",url);
        }
        
        function setItemsvalue(jsonData){
        	itemsvalue = [];
        	itemsvalue = new Array();
        	for (var i = 0; i < jsonData.length; i++) {
        		var items =new Object()
	        	items.id = 'rMenu1'+i;
				items.icon = '#{constantBean.contextPath}/images/logs.png';
				items.text = jsonData[i].subject;
				itemsvalue[i] = items;
				var faqshowid = jsonData[i].id;
				//增加菜单点击事件
				itemsvalue[i].handler = function (node){
				    //alert(node.value);
				    window.open("../pages/sysmgr/faq/faqshow.xhtml?id="+faqshowid);
				}
			}
			console.log(itemsvalue);
        }
	        
	 	//定义右键菜单
	    var rightClick ;
	 	
    	Ext.onReady(function(){
			$('.x-tab-panel-body').css('background-color','#c7edcc');
			
			//$('.x-panel-body').css('background-color','#c7edcc');
			
			//增加右键点击事件
		     navTreeJsVar.on('contextmenu',function(node,event){//声明菜单类型
		     		itemsvalue = [];
					treemoduleid = node.id.match(/[0-9]+/g)[0];
					$.ajax({
		               type: "GET",  //提交方式  
		               dataType: "json", //数据类型  
		               async : false,
					   url:'/scp/service?src=webServer&action=commonQueryByXml&sqlId=servlet.web.main.indexBean.grid.page&qry='+treemoduleid,
		               success: function (jsonData) { //提交成功的回调函数  
						   if(jsonData) {
			                   setItemsvalue(jsonData);
						   }
						}
				 	});
					rightClick = new Ext.menu.Menu({
				        id :'rightClickCont',
				        items : itemsvalue
				     });
					event.preventDefault();
					rightClick.showAt(event.getXY());//取得鼠标点击坐标，展示菜单
		     });
		     setBgColor();
		});
		
		function setBgColor(){
			var bgcolor = bgcolorJsVar.getValue();
			window.localStorage.bgcolor = bgcolor;
			setUserBgColor();
		}
	 //]]>
	</script>
</f:view>
